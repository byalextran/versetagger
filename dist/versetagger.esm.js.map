{
  "version": 3,
  "sources": ["../src/core/config.ts", "../src/parser/book-mappings.ts", "../src/parser/bible-versions.ts", "../src/parser/reference-parser.ts", "../src/core/scanner.ts", "../src/api/youversion-client.ts", "../src/modal/modal-styles.ts", "../src/modal/modal-manager.ts", "../src/utils/debounce.ts", "../src/modal/event-handler.ts", "../src/utils/sanitizer.ts", "../src/modal/modal-renderer.ts", "../src/theming/preset-themes.ts", "../src/theming/css-injector.ts", "../src/theming/theme-manager.ts", "../src/core/VerseTagger.ts", "../src/index.ts"],
  "sourcesContent": ["/**\n * Configuration system for VerseTagger\n * Type-safe configuration with validation and defaults\n */\n\nexport type BehaviorMode = 'link-only' | 'modal-only' | 'both';\nexport type TriggerMode = 'hover' | 'click' | 'both';\nexport type ColorScheme = 'light' | 'dark' | 'auto';\n\nexport interface VersetaggerConfig {\n  /**\n   * Required: URL of the proxy server that forwards requests to YouVersion API\n   * Example: \"https://your-worker.workers.dev/api/verses\"\n   */\n  proxyUrl: string;\n\n  /**\n   * Behavior mode for scripture references\n   * - 'link-only': Only convert to clickable links (no modal)\n   * - 'modal-only': Show modals but don't make links\n   * - 'both': Convert to links AND show modals\n   * @default 'both'\n   */\n  behavior?: BehaviorMode;\n\n  /**\n   * How to trigger the modal display\n   * - 'hover': Show on mouse hover\n   * - 'click': Show on click\n   * - 'both': Show on hover or click\n   * @default 'hover'\n   */\n  trigger?: TriggerMode;\n\n  /**\n   * Delay in milliseconds before showing modal on hover\n   * @default 500\n   */\n  hoverDelay?: number;\n\n  /**\n   * Automatically scan the DOM on initialization\n   * @default true\n   */\n  autoScan?: boolean;\n\n  /**\n   * CSS selector for elements to exclude from scanning\n   * @default 'code, pre, script, style, .no-verse-tagging'\n   */\n  excludeSelectors?: string;\n\n  /**\n   * Default Bible version to use when not specified in reference\n   * @default 'NIV'\n   */\n  defaultVersion?: string;\n\n  /**\n   * Color scheme for modals\n   * - 'light': Light theme\n   * - 'dark': Dark theme\n   * - 'auto': Detect from system preference\n   * @default 'auto'\n   */\n  colorScheme?: ColorScheme;\n\n  /**\n   * Theme name or custom theme object\n   * @default 'default'\n   */\n  theme?: string | object;\n\n  /**\n   * Accessibility configuration\n   */\n  accessibility?: {\n    /**\n     * Enable keyboard navigation\n     * @default true\n     */\n    keyboardNav?: boolean;\n\n    /**\n     * Enable screen reader announcements\n     * @default true\n     */\n    announceToScreenReaders?: boolean;\n  };\n\n  /**\n   * Custom CSS class to add to tagged references\n   * @default 'verse-reference'\n   */\n  referenceClass?: string;\n\n  /**\n   * Whether to open links in new tab\n   * @default true\n   */\n  openLinksInNewTab?: boolean;\n\n  /**\n   * Custom link format for YouVersion\n   * Use {book}, {chapter}, {verses}, {version} as placeholders\n   * @default 'https://www.bible.com/bible/{version}/{book}.{chapter}.{verses}'\n   */\n  linkFormat?: string;\n\n  /**\n   * Enable debug logging\n   * @default false\n   */\n  debug?: boolean;\n}\n\n/**\n * Default configuration values\n */\nexport const DEFAULT_CONFIG: Required<VersetaggerConfig> = {\n  proxyUrl: '', // Required, no default\n  behavior: 'both',\n  trigger: 'hover',\n  hoverDelay: 500,\n  autoScan: true,\n  excludeSelectors: 'code, pre, script, style, head, meta, title, link, noscript, svg, canvas, iframe, video, select, option, button, a, .no-verse-tagging',\n  defaultVersion: 'NIV',\n  colorScheme: 'auto',\n  theme: 'default',\n  accessibility: {\n    keyboardNav: true,\n    announceToScreenReaders: true\n  },\n  referenceClass: 'verse-reference',\n  openLinksInNewTab: true,\n  linkFormat: 'https://www.bible.com/bible/{version}/{book}.{chapter}.{verses}',\n  debug: false\n};\n\n/**\n * Merge user config with defaults\n */\nexport function mergeConfig(userConfig: VersetaggerConfig): Required<VersetaggerConfig> {\n  return {\n    ...DEFAULT_CONFIG,\n    ...userConfig,\n    accessibility: {\n      ...DEFAULT_CONFIG.accessibility,\n      ...(userConfig.accessibility || {})\n    }\n  };\n}\n\n/**\n * Validate configuration\n * Throws error if configuration is invalid\n */\nexport function validateConfig(config: VersetaggerConfig): void {\n  // Required fields\n  if (!config.proxyUrl) {\n    throw new Error(\n      'VerseTagger: proxyUrl is required. Please provide a URL to your API proxy server. ' +\n      'See documentation for proxy setup: https://github.com/yourusername/versetagger#proxy-setup'\n    );\n  }\n\n  // Validate URL format\n  try {\n    new URL(config.proxyUrl);\n  } catch {\n    throw new Error(`VerseTagger: Invalid proxyUrl \"${config.proxyUrl}\". Must be a valid URL.`);\n  }\n\n  // Validate behavior mode\n  if (config.behavior && !['link-only', 'modal-only', 'both'].includes(config.behavior)) {\n    throw new Error(\n      `VerseTagger: Invalid behavior \"${config.behavior}\". Must be \"link-only\", \"modal-only\", or \"both\".`\n    );\n  }\n\n  // Validate trigger mode\n  if (config.trigger && !['hover', 'click', 'both'].includes(config.trigger)) {\n    throw new Error(\n      `VerseTagger: Invalid trigger \"${config.trigger}\". Must be \"hover\", \"click\", or \"both\".`\n    );\n  }\n\n  // Validate color scheme\n  if (config.colorScheme && !['light', 'dark', 'auto'].includes(config.colorScheme)) {\n    throw new Error(\n      `VerseTagger: Invalid colorScheme \"${config.colorScheme}\". Must be \"light\", \"dark\", or \"auto\".`\n    );\n  }\n\n  // Validate hover delay\n  if (config.hoverDelay !== undefined && (config.hoverDelay < 0 || config.hoverDelay > 5000)) {\n    throw new Error(\n      `VerseTagger: Invalid hoverDelay \"${config.hoverDelay}\". Must be between 0 and 5000ms.`\n    );\n  }\n}\n\n/**\n * Create and validate configuration\n */\nexport function createConfig(userConfig: VersetaggerConfig): Required<VersetaggerConfig> {\n  validateConfig(userConfig);\n  return mergeConfig(userConfig);\n}\n", "/**\n * Book mappings for scripture references\n * Maps book names, abbreviations, and common variations to YouVersion book codes\n */\n\nexport interface BookMapping {\n  name: string;\n  code: string;\n  testament: 'OT' | 'NT';\n  abbreviations: string[];\n  alternateNames: string[];\n}\n\nexport const BOOK_MAPPINGS: BookMapping[] = [\n  // Old Testament\n  {\n    name: 'Genesis',\n    code: 'GEN',\n    testament: 'OT',\n    abbreviations: ['Gen'],\n    alternateNames: []\n  },\n  {\n    name: 'Exodus',\n    code: 'EXO',\n    testament: 'OT',\n    abbreviations: ['Ex'],\n    alternateNames: []\n  },\n  {\n    name: 'Leviticus',\n    code: 'LEV',\n    testament: 'OT',\n    abbreviations: ['Lev'],\n    alternateNames: []\n  },\n  {\n    name: 'Numbers',\n    code: 'NUM',\n    testament: 'OT',\n    abbreviations: ['Num'],\n    alternateNames: []\n  },\n  {\n    name: 'Deuteronomy',\n    code: 'DEU',\n    testament: 'OT',\n    abbreviations: ['Deut'],\n    alternateNames: []\n  },\n  {\n    name: 'Joshua',\n    code: 'JOS',\n    testament: 'OT',\n    abbreviations: ['Josh'],\n    alternateNames: []\n  },\n  {\n    name: 'Judges',\n    code: 'JDG',\n    testament: 'OT',\n    abbreviations: ['Judg'],\n    alternateNames: []\n  },\n  {\n    name: 'Ruth',\n    code: 'RUT',\n    testament: 'OT',\n    abbreviations: [],\n    alternateNames: []\n  },\n  {\n    name: '1 Samuel',\n    code: '1SA',\n    testament: 'OT',\n    abbreviations: ['1 Sam'],\n    alternateNames: []\n  },\n  {\n    name: '2 Samuel',\n    code: '2SA',\n    testament: 'OT',\n    abbreviations: ['2 Sam'],\n    alternateNames: []\n  },\n  {\n    name: '1 Kings',\n    code: '1KI',\n    testament: 'OT',\n    abbreviations: [],\n    alternateNames: []\n  },\n  {\n    name: '2 Kings',\n    code: '2KI',\n    testament: 'OT',\n    abbreviations: [],\n    alternateNames: []\n  },\n  {\n    name: '1 Chronicles',\n    code: '1CH',\n    testament: 'OT',\n    abbreviations: ['1 Chron'],\n    alternateNames: []\n  },\n  {\n    name: '2 Chronicles',\n    code: '2CH',\n    testament: 'OT',\n    abbreviations: ['2 Chron'],\n    alternateNames: []\n  },\n  {\n    name: 'Ezra',\n    code: 'EZR',\n    testament: 'OT',\n    abbreviations: [],\n    alternateNames: []\n  },\n  {\n    name: 'Nehemiah',\n    code: 'NEH',\n    testament: 'OT',\n    abbreviations: ['Neh'],\n    alternateNames: []\n  },\n  {\n    name: 'Esther',\n    code: 'EST',\n    testament: 'OT',\n    abbreviations: ['Est'],\n    alternateNames: []\n  },\n  {\n    name: 'Job',\n    code: 'JOB',\n    testament: 'OT',\n    abbreviations: [],\n    alternateNames: []\n  },\n  {\n    name: 'Psalm',\n    code: 'PSA',\n    testament: 'OT',\n    abbreviations: ['Ps'],\n    alternateNames: []\n  },\n  {\n    name: 'Proverbs',\n    code: 'PRO',\n    testament: 'OT',\n    abbreviations: ['Prov'],\n    alternateNames: []\n  },\n  {\n    name: 'Ecclesiastes',\n    code: 'ECC',\n    testament: 'OT',\n    abbreviations: ['Eccles'],\n    alternateNames: []\n  },\n  {\n    name: 'Song of Solomon',\n    code: 'SNG',\n    testament: 'OT',\n    abbreviations: ['Song'],\n    alternateNames: []\n  },\n  {\n    name: 'Isaiah',\n    code: 'ISA',\n    testament: 'OT',\n    abbreviations: ['Isa'],\n    alternateNames: []\n  },\n  {\n    name: 'Jeremiah',\n    code: 'JER',\n    testament: 'OT',\n    abbreviations: ['Jer'],\n    alternateNames: []\n  },\n  {\n    name: 'Lamentations',\n    code: 'LAM',\n    testament: 'OT',\n    abbreviations: ['Lam'],\n    alternateNames: []\n  },\n  {\n    name: 'Ezekiel',\n    code: 'EZK',\n    testament: 'OT',\n    abbreviations: ['Ezek'],\n    alternateNames: []\n  },\n  {\n    name: 'Daniel',\n    code: 'DAN',\n    testament: 'OT',\n    abbreviations: ['Dan'],\n    alternateNames: []\n  },\n  {\n    name: 'Hosea',\n    code: 'HOS',\n    testament: 'OT',\n    abbreviations: ['Hos'],\n    alternateNames: []\n  },\n  {\n    name: 'Joel',\n    code: 'JOL',\n    testament: 'OT',\n    abbreviations: [],\n    alternateNames: []\n  },\n  {\n    name: 'Amos',\n    code: 'AMO',\n    testament: 'OT',\n    abbreviations: [],\n    alternateNames: []\n  },\n  {\n    name: 'Obadiah',\n    code: 'OBA',\n    testament: 'OT',\n    abbreviations: ['Obad'],\n    alternateNames: []\n  },\n  {\n    name: 'Jonah',\n    code: 'JON',\n    testament: 'OT',\n    abbreviations: [],\n    alternateNames: []\n  },\n  {\n    name: 'Micah',\n    code: 'MIC',\n    testament: 'OT',\n    abbreviations: ['Mic'],\n    alternateNames: []\n  },\n  {\n    name: 'Nahum',\n    code: 'NAM',\n    testament: 'OT',\n    abbreviations: ['Nah'],\n    alternateNames: []\n  },\n  {\n    name: 'Habakkuk',\n    code: 'HAB',\n    testament: 'OT',\n    abbreviations: ['Hab'],\n    alternateNames: []\n  },\n  {\n    name: 'Zephaniah',\n    code: 'ZEP',\n    testament: 'OT',\n    abbreviations: ['Zeph'],\n    alternateNames: []\n  },\n  {\n    name: 'Haggai',\n    code: 'HAG',\n    testament: 'OT',\n    abbreviations: ['Hag'],\n    alternateNames: []\n  },\n  {\n    name: 'Zechariah',\n    code: 'ZEC',\n    testament: 'OT',\n    abbreviations: ['Zech'],\n    alternateNames: []\n  },\n  {\n    name: 'Malachi',\n    code: 'MAL',\n    testament: 'OT',\n    abbreviations: ['Mal'],\n    alternateNames: []\n  },\n\n  // New Testament\n  {\n    name: 'Matthew',\n    code: 'MAT',\n    testament: 'NT',\n    abbreviations: ['Matt'],\n    alternateNames: []\n  },\n  {\n    name: 'Mark',\n    code: 'MRK',\n    testament: 'NT',\n    abbreviations: [],\n    alternateNames: []\n  },\n  {\n    name: 'Luke',\n    code: 'LUK',\n    testament: 'NT',\n    abbreviations: [],\n    alternateNames: []\n  },\n  {\n    name: 'John',\n    code: 'JHN',\n    testament: 'NT',\n    abbreviations: [],\n    alternateNames: []\n  },\n  {\n    name: 'Acts',\n    code: 'ACT',\n    testament: 'NT',\n    abbreviations: [],\n    alternateNames: []\n  },\n  {\n    name: 'Romans',\n    code: 'ROM',\n    testament: 'NT',\n    abbreviations: ['Rom'],\n    alternateNames: []\n  },\n  {\n    name: '1 Corinthians',\n    code: '1CO',\n    testament: 'NT',\n    abbreviations: ['1 Cor'],\n    alternateNames: []\n  },\n  {\n    name: '2 Corinthians',\n    code: '2CO',\n    testament: 'NT',\n    abbreviations: ['2 Cor'],\n    alternateNames: []\n  },\n  {\n    name: 'Galatians',\n    code: 'GAL',\n    testament: 'NT',\n    abbreviations: ['Gal'],\n    alternateNames: []\n  },\n  {\n    name: 'Ephesians',\n    code: 'EPH',\n    testament: 'NT',\n    abbreviations: ['Eph'],\n    alternateNames: []\n  },\n  {\n    name: 'Philippians',\n    code: 'PHP',\n    testament: 'NT',\n    abbreviations: ['Phil'],\n    alternateNames: []\n  },\n  {\n    name: 'Colossians',\n    code: 'COL',\n    testament: 'NT',\n    abbreviations: ['Col'],\n    alternateNames: []\n  },\n  {\n    name: '1 Thessalonians',\n    code: '1TH',\n    testament: 'NT',\n    abbreviations: ['1 Thess'],\n    alternateNames: []\n  },\n  {\n    name: '2 Thessalonians',\n    code: '2TH',\n    testament: 'NT',\n    abbreviations: ['2 Thess'],\n    alternateNames: []\n  },\n  {\n    name: '1 Timothy',\n    code: '1TI',\n    testament: 'NT',\n    abbreviations: ['1 Tim'],\n    alternateNames: []\n  },\n  {\n    name: '2 Timothy',\n    code: '2TI',\n    testament: 'NT',\n    abbreviations: ['2 Tim'],\n    alternateNames: []\n  },\n  {\n    name: 'Titus',\n    code: 'TIT',\n    testament: 'NT',\n    abbreviations: [],\n    alternateNames: []\n  },\n  {\n    name: 'Philemon',\n    code: 'PHM',\n    testament: 'NT',\n    abbreviations: ['Philem'],\n    alternateNames: []\n  },\n  {\n    name: 'Hebrews',\n    code: 'HEB',\n    testament: 'NT',\n    abbreviations: ['Heb'],\n    alternateNames: []\n  },\n  {\n    name: 'James',\n    code: 'JAS',\n    testament: 'NT',\n    abbreviations: [],\n    alternateNames: []\n  },\n  {\n    name: '1 Peter',\n    code: '1PE',\n    testament: 'NT',\n    abbreviations: ['1 Pet'],\n    alternateNames: []\n  },\n  {\n    name: '2 Peter',\n    code: '2PE',\n    testament: 'NT',\n    abbreviations: ['2 Pet'],\n    alternateNames: []\n  },\n  {\n    name: '1 John',\n    code: '1JN',\n    testament: 'NT',\n    abbreviations: [],\n    alternateNames: []\n  },\n  {\n    name: '2 John',\n    code: '2JN',\n    testament: 'NT',\n    abbreviations: [],\n    alternateNames: []\n  },\n  {\n    name: '3 John',\n    code: '3JN',\n    testament: 'NT',\n    abbreviations: [],\n    alternateNames: []\n  },\n  {\n    name: 'Jude',\n    code: 'JUD',\n    testament: 'NT',\n    abbreviations: [],\n    alternateNames: []\n  },\n  {\n    name: 'Revelation',\n    code: 'REV',\n    testament: 'NT',\n    abbreviations: ['Rev'],\n    alternateNames: []\n  }\n];\n\n/**\n * Build a lookup map for fast book name resolution\n * Maps normalized names/abbreviations to book codes\n */\nexport function buildBookLookup(): Map<string, BookMapping> {\n  const lookup = new Map<string, BookMapping>();\n\n  for (const book of BOOK_MAPPINGS) {\n    // Add full name\n    lookup.set(normalizeBookName(book.name), book);\n\n    // Add book code (e.g., \"GEN\", \"PRO\", \"JER\")\n    lookup.set(normalizeBookName(book.code), book);\n\n    // Add all abbreviations\n    for (const abbr of book.abbreviations) {\n      lookup.set(normalizeBookName(abbr), book);\n    }\n\n    // Add all alternate names\n    for (const alt of book.alternateNames) {\n      lookup.set(normalizeBookName(alt), book);\n    }\n  }\n\n  return lookup;\n}\n\n/**\n * Normalize book name for lookup\n * Removes extra spaces, converts to lowercase, removes periods\n */\nexport function normalizeBookName(name: string): string {\n  return name\n    .toLowerCase()\n    .replace(/\\./g, '')  // Remove periods\n    .replace(/\\s+/g, ' ')  // Normalize spaces\n    .trim();\n}\n\n/**\n * Find a book by name or abbreviation\n */\nconst bookLookup = buildBookLookup();\n\nexport function findBook(bookName: string): BookMapping | undefined {\n  return bookLookup.get(normalizeBookName(bookName));\n}\n\n/**\n * Get all book names (for building regex patterns)\n */\nexport function getAllBookNames(): string[] {\n  const names: string[] = [];\n\n  for (const book of BOOK_MAPPINGS) {\n    names.push(book.name);\n    names.push(...book.abbreviations);\n    names.push(...book.alternateNames);\n  }\n\n  return names;\n}\n\n/**\n * Get regex pattern for matching book names\n * Returns a pattern that matches all book names, abbreviations, and alternate names\n * Pattern is sorted by length (longest first) to ensure proper matching\n */\nexport function getBookNamesRegex(): string {\n  const names = getAllBookNames();\n\n  // Sort by length (longest first) to match longer names before shorter ones\n  // This ensures \"1 Corinthians\" matches before \"1 Cor\"\n  names.sort((a, b) => b.length - a.length);\n\n  // Escape special regex characters and join with |\n  return names\n    .map(name => name.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'))\n    .join('|');\n}\n", "/**\n * Bible version mappings for VerseTagger\n * Generated by update-translations.ts\n * Last updated: 2025-12-18T01:48:54.841Z\n * Source: bible-versions.html (YouVersion Bible picker)\n */\n\n/**\n * Bible version metadata\n */\nexport interface BibleVersion {\n  /** YouVersion Bible ID */\n  id: number;\n  /** Version abbreviation (e.g., \"NIV\", \"KJV\") */\n  abbreviation: string;\n  /** Full version title */\n  title: string;\n  /** Whether this version is licensed */\n  licensed: boolean;\n}\n\n/**\n * All available Bible versions (English only)\n */\nexport const BIBLE_VERSIONS: BibleVersion[] = [\n  {\n    id: 4253,\n    abbreviation: 'AFV',\n    title: 'A Faithful Version',\n    licensed: false\n  },\n  {\n    id: 1588,\n    abbreviation: 'AMP',\n    title: 'Amplified Bible',\n    licensed: true\n  },\n  {\n    id: 8,\n    abbreviation: 'AMPC',\n    title: 'Amplified Bible, Classic Edition',\n    licensed: false\n  },\n  {\n    id: 12,\n    abbreviation: 'ASV',\n    title: 'American Standard Version',\n    licensed: true\n  },\n  {\n    id: 31,\n    abbreviation: 'BOOKS',\n    title: 'The Books of the Bible NT',\n    licensed: false\n  },\n  {\n    id: 3034,\n    abbreviation: 'BSB',\n    title: 'English: Berean Standard Bible',\n    licensed: true\n  },\n  {\n    id: 37,\n    abbreviation: 'CEB',\n    title: 'Common English Bible',\n    licensed: false\n  },\n  {\n    id: 392,\n    abbreviation: 'CEV',\n    title: 'Contemporary English Version',\n    licensed: false\n  },\n  {\n    id: 303,\n    abbreviation: 'CEVDCI',\n    title: 'Contemporary English Version Interconfessional Edition',\n    licensed: false\n  },\n  {\n    id: 294,\n    abbreviation: 'CEVUK',\n    title: 'Contemporary English Version (Anglicised) 2012',\n    licensed: false\n  },\n  {\n    id: 1275,\n    abbreviation: 'CJB',\n    title: 'Complete Jewish Bible',\n    licensed: false\n  },\n  {\n    id: 42,\n    abbreviation: 'CPDV',\n    title: 'Catholic Public Domain Version',\n    licensed: true\n  },\n  {\n    id: 1713,\n    abbreviation: 'CSB',\n    title: 'Christian Standard Bible',\n    licensed: false\n  },\n  {\n    id: 4124,\n    abbreviation: 'CSBA',\n    title: 'Christian Standard Bible Anglicised',\n    licensed: false\n  },\n  {\n    id: 478,\n    abbreviation: 'DARBY',\n    title: \"Darby's Translation 1890\",\n    licensed: false\n  },\n  {\n    id: 55,\n    abbreviation: 'DRC1752',\n    title: 'Douay-Rheims Challoner Revision 1752',\n    licensed: false\n  },\n  {\n    id: 2079,\n    abbreviation: 'EASY',\n    title: 'EasyEnglish Bible 2024',\n    licensed: true\n  },\n  {\n    id: 4224,\n    abbreviation: 'EHV',\n    title: 'Evangelical Heritage Version - 2021',\n    licensed: false\n  },\n  {\n    id: 406,\n    abbreviation: 'ERV',\n    title: 'Holy Bible: Easy-to-Read Version',\n    licensed: false\n  },\n  {\n    id: 59,\n    abbreviation: 'ESV',\n    title: 'English Standard Version 2025',\n    licensed: false\n  },\n  {\n    id: 1932,\n    abbreviation: 'FBV',\n    title: 'Free Bible Version',\n    licensed: true\n  },\n  {\n    id: 3633,\n    abbreviation: 'FNVNT',\n    title: 'First Nations Version',\n    licensed: false\n  },\n  {\n    id: 416,\n    abbreviation: 'GNBDC',\n    title: 'Good News Bible (British) with DC section 2017',\n    licensed: false\n  },\n  {\n    id: 431,\n    abbreviation: 'GNBDK',\n    title: 'Good News Bible (British) Catholic Edition 2017',\n    licensed: false\n  },\n  {\n    id: 296,\n    abbreviation: 'GNBUK',\n    title: 'Good News Bible (British Version) 2017',\n    licensed: false\n  },\n  {\n    id: 68,\n    abbreviation: 'GNT',\n    title: 'Good News Translation',\n    licensed: false\n  },\n  {\n    id: 69,\n    abbreviation: 'GNTD',\n    title: 'Good News Translation (US Version)',\n    licensed: false\n  },\n  {\n    id: 2163,\n    abbreviation: 'GNV',\n    title: 'Geneva Bible',\n    licensed: true\n  },\n  {\n    id: 70,\n    abbreviation: 'GW',\n    title: \"GOD'S WORD\",\n    licensed: false\n  },\n  {\n    id: 1047,\n    abbreviation: 'GWC',\n    title: 'St Paul from the Trenches 1916',\n    licensed: false\n  },\n  {\n    id: 72,\n    abbreviation: 'HCSB',\n    title: 'Holman Christian Standard Bible',\n    licensed: false\n  },\n  {\n    id: 1359,\n    abbreviation: 'ICB',\n    title: \"International Children's Bible\",\n    licensed: false\n  },\n  {\n    id: 1077,\n    abbreviation: 'JUB',\n    title: 'Jubilee Bible',\n    licensed: false\n  },\n  {\n    id: 1,\n    abbreviation: 'KJV',\n    title: 'King James Version',\n    licensed: false\n  },\n  {\n    id: 546,\n    abbreviation: 'KJVAAE',\n    title: 'King James Version with Apocrypha, American Edition',\n    licensed: false\n  },\n  {\n    id: 547,\n    abbreviation: 'KJVAE',\n    title: 'King James Version, American Edition',\n    licensed: false\n  },\n  {\n    id: 90,\n    abbreviation: 'LEB',\n    title: 'Lexham English Bible',\n    licensed: false\n  },\n  {\n    id: 3345,\n    abbreviation: 'LSB',\n    title: 'Legacy Standard Bible',\n    licensed: false\n  },\n  {\n    id: 2660,\n    abbreviation: 'LSV',\n    title: 'Literal Standard Version',\n    licensed: true\n  },\n  {\n    id: 1171,\n    abbreviation: 'MEV',\n    title: 'Modern English Version',\n    licensed: false\n  },\n  {\n    id: 4540,\n    abbreviation: 'MP1562',\n    title: 'Metrical Psalms and Scripture Selections 1562 (Sternhold and Hopkins)',\n    licensed: false\n  },\n  {\n    id: 1365,\n    abbreviation: 'MP1650',\n    title: 'Psalms of David in Metre 1650 (Scottish Psalter)',\n    licensed: false\n  },\n  {\n    id: 2593,\n    abbreviation: 'MP1696',\n    title: 'Metrical Psalms and Scripture Selections 1696 (Brady &amp; Tate)',\n    licensed: false\n  },\n  {\n    id: 3051,\n    abbreviation: 'MP1781',\n    title: 'Scottish Metrical Paraphrases 1781',\n    licensed: false\n  },\n  {\n    id: 97,\n    abbreviation: 'MSG',\n    title: 'The Message',\n    licensed: false\n  },\n  {\n    id: 463,\n    abbreviation: 'NABRE',\n    title: 'New American Bible, revised edition',\n    licensed: false\n  },\n  {\n    id: 100,\n    abbreviation: 'NASB1995',\n    title: 'New American Standard Bible - NASB 1995',\n    licensed: true\n  },\n  {\n    id: 2692,\n    abbreviation: 'NASB2020',\n    title: 'New American Standard Bible - NASB',\n    licensed: true\n  },\n  {\n    id: 105,\n    abbreviation: 'NCV',\n    title: 'New Century Version',\n    licensed: false\n  },\n  {\n    id: 107,\n    abbreviation: 'NET',\n    title: 'New English Translation',\n    licensed: false\n  },\n  {\n    id: 110,\n    abbreviation: 'NIRV',\n    title: \"New International Reader's Version\",\n    licensed: true\n  },\n  {\n    id: 111,\n    abbreviation: 'NIV',\n    title: 'New International Version',\n    licensed: true\n  },\n  {\n    id: 113,\n    abbreviation: 'NIVUK',\n    title: 'New International Version (Anglicised)',\n    licensed: true\n  },\n  {\n    id: 114,\n    abbreviation: 'NKJV',\n    title: 'New King James Version',\n    licensed: false\n  },\n  {\n    id: 116,\n    abbreviation: 'NLT',\n    title: 'New Living Translation',\n    licensed: false\n  },\n  {\n    id: 4249,\n    abbreviation: 'NLTCE',\n    title: 'New Living Translation Catholic Edition',\n    licensed: false\n  },\n  {\n    id: 2135,\n    abbreviation: 'NMV',\n    title: 'New Messianic Version Bible',\n    licensed: false\n  },\n  {\n    id: 2015,\n    abbreviation: 'NRSV-CI',\n    title: 'New Revised Standard Version Catholic Interconfessional',\n    licensed: false\n  },\n  {\n    id: 3523,\n    abbreviation: 'NRSVUE',\n    title: 'New Revised Standard Version Updated Edition 2021',\n    licensed: false\n  },\n  {\n    id: 4455,\n    abbreviation: 'NTBNBL2025',\n    title: 'Benamanga',\n    licensed: true\n  },\n  {\n    id: 3915,\n    abbreviation: 'OYBCENGL',\n    title: 'The third line (in English) translating the meaning of each word in the Orthodox Yiddish Brit Chadashah (New Testament)',\n    licensed: false\n  },\n  {\n    id: 4557,\n    abbreviation: 'OYTNKHEG',\n    title: 'English word for word translation of Orthodox Yiddish Tanakh (OYTANAKH)',\n    licensed: false\n  },\n  {\n    id: 4070,\n    abbreviation: 'OYTORHEG',\n    title: 'Translation into English of Orthodox Yiddish Torah (OYTORAH)',\n    licensed: false\n  },\n  {\n    id: 2530,\n    abbreviation: 'PEV',\n    title: 'Plain English Version',\n    licensed: true\n  },\n  {\n    id: 2753,\n    abbreviation: 'RAD',\n    title: 'Radiate New Testament',\n    licensed: false\n  },\n  {\n    id: 2020,\n    abbreviation: 'RSV',\n    title: 'Revised Standard Version',\n    licensed: false\n  },\n  {\n    id: 2017,\n    abbreviation: 'RSV-C',\n    title: 'Revised Standard Version Old Tradition 1952',\n    licensed: false\n  },\n  {\n    id: 3548,\n    abbreviation: 'RSVCI',\n    title: 'Revised Standard Version',\n    licensed: false\n  },\n  {\n    id: 477,\n    abbreviation: 'RV1885',\n    title: 'Revised Version 1885',\n    licensed: false\n  },\n  {\n    id: 1922,\n    abbreviation: 'RV1895',\n    title: 'Revised Version with Apocrypha 1885, 1895',\n    licensed: false\n  },\n  {\n    id: 3427,\n    abbreviation: 'TCENT',\n    title: 'The Text-Critical English New Testament',\n    licensed: true\n  },\n  {\n    id: 3010,\n    abbreviation: 'TEG',\n    title: 'Isaiah 1830, 1842 (John Jones alias Ioan Tegid)',\n    licensed: false\n  },\n  {\n    id: 314,\n    abbreviation: 'TLV',\n    title: 'Tree of Life Version',\n    licensed: false\n  },\n  {\n    id: 130,\n    abbreviation: 'TOJB2011',\n    title: 'The Orthodox Jewish Bible',\n    licensed: true\n  },\n  {\n    id: 1849,\n    abbreviation: 'TPT',\n    title: 'The Passion Translation',\n    licensed: true\n  },\n  {\n    id: 316,\n    abbreviation: 'TS2009',\n    title: 'The Scriptures 2009',\n    licensed: false\n  },\n  {\n    id: 2407,\n    abbreviation: 'WBMS',\n    title: \"Wycliffe's Bible with Modern Spelling\",\n    licensed: false\n  },\n  {\n    id: 4533,\n    abbreviation: 'WBTP',\n    title: 'Af\u0101 Wany\u025Bny\u025B wu Nug\u00E9 W\u00E0py\u00F3\u00F2',\n    licensed: true\n  },\n  {\n    id: 1204,\n    abbreviation: 'WEBBE',\n    title: 'World English Bible British Edition',\n    licensed: true\n  },\n  {\n    id: 206,\n    abbreviation: 'WEBUS',\n    title: \"World English Bible, American English Edition, without Strong's Numbers\",\n    licensed: true\n  },\n  {\n    id: 1209,\n    abbreviation: 'WMB',\n    title: 'World Messianic Bible',\n    licensed: true\n  },\n  {\n    id: 1207,\n    abbreviation: 'WMBBE',\n    title: 'World Messianic Bible British Edition',\n    licensed: true\n  },\n  {\n    id: 4108,\n    abbreviation: 'YALL',\n    title: \"Y'all Version Bible\",\n    licensed: false\n  },\n  {\n    id: 821,\n    abbreviation: 'YLT98',\n    title: \"Young's Literal Translation 1898\",\n    licensed: false\n  }\n];\n\n/**\n * Build lookup map for fast version resolution\n */\nexport function buildVersionLookup(): Map<string, BibleVersion> {\n  const lookup = new Map<string, BibleVersion>();\n\n  for (const version of BIBLE_VERSIONS) {\n    // Map by abbreviation (case-insensitive)\n    lookup.set(version.abbreviation.toUpperCase(), version);\n  }\n\n  return lookup;\n}\n\n/**\n * Pre-built version lookup map\n */\nconst versionLookup = buildVersionLookup();\n\n/**\n * Find a Bible version by abbreviation (case-insensitive)\n */\nexport function findVersion(abbreviation: string): BibleVersion | undefined {\n  return versionLookup.get(abbreviation.toUpperCase());\n}\n\n/**\n * Get regex pattern for matching Bible version abbreviations\n * Returns a pattern that matches all valid translation abbreviations\n * Pattern is sorted by length (longest first) to ensure proper matching\n */\nexport function getTranslationsRegex(): string {\n  const abbreviations = BIBLE_VERSIONS.map(v => v.abbreviation);\n\n  // Sort by length (longest first) to match longer abbreviations before shorter ones\n  abbreviations.sort((a, b) => b.length - a.length);\n\n  // Escape special regex characters and join with |\n  return abbreviations\n    .map(abbr => abbr.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&'))\n    .join('|');\n}\n", "/**\n * Scripture reference parser\n * Parses scripture references from text and extracts structured data\n */\n\nimport { findBook, getBookNamesRegex } from './book-mappings';\nimport { getTranslationsRegex } from './bible-versions';\n\nexport interface ScriptureReference {\n  /** Original matched text */\n  text: string;\n  /** Book code (e.g., \"GEN\", \"MAT\") */\n  book: string;\n  /** Chapter number */\n  chapter: number;\n  /** Verse range string exactly as matched (e.g., \"1-5\", \"1,3,5-7\") */\n  verses: string;\n  /** Bible version (e.g., \"NIV\", \"ESV\"), undefined if not specified */\n  version?: string;\n  /** Start position in original text */\n  startIndex: number;\n  /** End position in original text */\n  endIndex: number;\n}\n\n/**\n * Build regex pattern for matching scripture references\n * Matches patterns like:\n * - John 3:16\n * - 1 John 2:1-5\n * - Matthew 5:1-10,12-15\n * - Psalm 23\n * - Gen 1:1 NIV\n * - Matt 6:33 ESV\n */\nlet referencePattern: RegExp | null = null;\n\nfunction buildReferencePattern(): RegExp {\n  if (referencePattern) {\n    return referencePattern;\n  }\n\n  // Get regex patterns from respective modules\n  const bookPattern = getBookNamesRegex();\n  const translationPattern = getTranslationsRegex();\n\n  // Build the complete pattern\n  // Format: <book> <chapter>:<verses> (<version>)?\n  // Examples:\n  //   John 3:16\n  //   1 John 2:1-5\n  //   Matthew 5:1-10,12-15\n  //   Matt 6:33 NIV\n  // Note: Verse numbers are required (chapter-only references are not matched)\n  referencePattern = new RegExp(\n    `\\\\b(${bookPattern})\\\\s+(\\\\d{1,3}):(\\\\d{1,3}(?:[\u2013\u2014-]\\\\d{1,3})?(?:,\\\\s*\\\\d{1,3}(?:[\u2013\u2014-]\\\\d{1,3})?)*)(?:\\\\s+(${translationPattern}))?\\\\b`,\n    'gi'\n  );\n\n  return referencePattern;\n}\n\n/**\n * Parse all scripture references from a text string\n */\nexport function parseReferences(text: string): ScriptureReference[] {\n  const pattern = buildReferencePattern();\n  const references: ScriptureReference[] = [];\n  let match: RegExpExecArray | null;\n\n  // Reset regex state\n  pattern.lastIndex = 0;\n\n  while ((match = pattern.exec(text)) !== null) {\n    const [fullMatch, bookName, chapterStr, versesStr, version] = match;\n\n    // Find the book mapping\n    const book = findBook(bookName);\n    if (!book) {\n      continue; // Skip if book not found\n    }\n\n    const chapter = parseInt(chapterStr, 10);\n    if (isNaN(chapter) || chapter <= 0) {\n      continue; // Skip invalid chapter\n    }\n\n    // Store verses exactly as matched (e.g., \"1-3\" stays as \"1-3\")\n    references.push({\n      text: fullMatch,\n      book: book.code,\n      chapter,\n      verses: versesStr,\n      version: version ? version.toUpperCase() : undefined,\n      startIndex: match.index,\n      endIndex: match.index + fullMatch.length\n    });\n  }\n\n  return references;\n}\n\n/**\n * Parse a single scripture reference string\n * Returns null if the reference is invalid\n */\nexport function parseReference(text: string): ScriptureReference | null {\n  const refs = parseReferences(text);\n  return refs.length > 0 ? refs[0] : null;\n}\n\n/**\n * Check if a string contains any scripture references\n */\nexport function containsReferences(text: string): boolean {\n  const pattern = buildReferencePattern();\n  pattern.lastIndex = 0;\n  return pattern.test(text);\n}\n\n/**\n * Format a scripture reference for display\n * Examples:\n *   formatReference({ book: \"JHN\", chapter: 3, verses: [16] }) => \"John 3:16\"\n *   formatReference({ book: \"MAT\", chapter: 5, verses: [1,2,3] }) => \"Matthew 5:1-3\"\n */\nexport function formatReference(ref: Partial<ScriptureReference>): string {\n  if (!ref.book || !ref.chapter) {\n    return '';\n  }\n\n  // Find book to get the full name\n  const book = findBook(ref.book);\n  const bookName = book ? book.name : ref.book;\n\n  let result = `${bookName} ${ref.chapter}`;\n\n  if (ref.verses && ref.verses.length > 0) {\n    // Use the range formatter for compact display\n    const verseStr = formatVerseRangeCompact(ref.verses);\n    result += `:${verseStr}`;\n  }\n\n  if (ref.version) {\n    result += ` ${ref.version}`;\n  }\n\n  return result;\n}\n\n/**\n * Helper to format verses compactly\n */\nfunction formatVerseRangeCompact(verses: number[]): string {\n  if (verses.length === 0) return '';\n  if (verses.length === 1) return verses[0].toString();\n\n  const sorted = [...verses].sort((a, b) => a - b);\n  const ranges: string[] = [];\n  let rangeStart = sorted[0];\n  let rangeEnd = sorted[0];\n\n  for (let i = 1; i < sorted.length; i++) {\n    if (sorted[i] === rangeEnd + 1) {\n      rangeEnd = sorted[i];\n    } else {\n      if (rangeStart === rangeEnd) {\n        ranges.push(rangeStart.toString());\n      } else {\n        ranges.push(`${rangeStart}-${rangeEnd}`);\n      }\n      rangeStart = sorted[i];\n      rangeEnd = sorted[i];\n    }\n  }\n\n  if (rangeStart === rangeEnd) {\n    ranges.push(rangeStart.toString());\n  } else {\n    ranges.push(`${rangeStart}-${rangeEnd}`);\n  }\n\n  return ranges.join(',');\n}\n\n/**\n * Validate that a reference is well-formed\n */\nexport function isValidReference(ref: Partial<ScriptureReference>): boolean {\n  if (!ref.book || !ref.chapter) {\n    return false;\n  }\n\n  const book = findBook(ref.book);\n  if (!book) {\n    return false;\n  }\n\n  if (ref.chapter <= 0) {\n    return false;\n  }\n\n  if (ref.verses && ref.verses.some(v => v <= 0)) {\n    return false;\n  }\n\n  return true;\n}\n", "/**\n * DOM Scanner\n * Scans the DOM for scripture references and wraps them in interactive elements\n */\n\nimport type { VersetaggerConfig } from './config';\nimport { parseReferences, type ScriptureReference } from '../parser/reference-parser';\nimport { findVersion } from '../parser/bible-versions';\n\nexport interface ScannedReference extends ScriptureReference {\n  /** The DOM element wrapping the reference */\n  element: HTMLElement;\n}\n\n/**\n * Scanner class for finding and tagging scripture references in the DOM\n */\nexport class DOMScanner {\n  private config: Required<VersetaggerConfig>;\n  private scannedNodes: WeakSet<Node>;\n  private excludedTags: Set<string>;\n  private excludedClasses: Set<string>;\n  private excludedIds: Set<string>;\n  private complexExcludeSelectors: string | null;\n\n  constructor(config: Required<VersetaggerConfig>) {\n    this.config = config;\n    this.scannedNodes = new WeakSet();\n\n    // Parse excludeSelectors into optimized lookup structures\n    const { tags, classes, ids, complex } = this.parseExcludeSelectors(config.excludeSelectors);\n    this.excludedTags = tags;\n    this.excludedClasses = classes;\n    this.excludedIds = ids;\n    this.complexExcludeSelectors = complex;\n  }\n\n  /**\n   * Parse excludeSelectors string into optimized lookup structures\n   * Separates simple selectors (tags, classes, IDs) from complex selectors\n   */\n  private parseExcludeSelectors(selectors: string): {\n    tags: Set<string>;\n    classes: Set<string>;\n    ids: Set<string>;\n    complex: string | null;\n  } {\n    const tags = new Set<string>();\n    const classes = new Set<string>();\n    const ids = new Set<string>();\n    const complexSelectors: string[] = [];\n\n    // Split by comma and process each selector\n    const selectorList = selectors.split(',').map(s => s.trim()).filter(s => s);\n\n    for (const selector of selectorList) {\n      // Simple tag selector (e.g., \"code\", \"pre\")\n      if (/^[a-z][a-z0-9]*$/i.test(selector)) {\n        tags.add(selector.toUpperCase());\n      }\n      // Simple class selector (e.g., \".no-verse-tagging\")\n      else if (/^\\.[a-z_-][a-z0-9_-]*$/i.test(selector)) {\n        classes.add(selector.substring(1));\n      }\n      // Simple ID selector (e.g., \"#sidebar\")\n      else if (/^#[a-z_-][a-z0-9_-]*$/i.test(selector)) {\n        ids.add(selector.substring(1));\n      }\n      // Complex selector (e.g., \"div.comment\", \"[data-foo]\", \"div > p\")\n      else {\n        complexSelectors.push(selector);\n      }\n    }\n\n    return {\n      tags,\n      classes,\n      ids,\n      complex: complexSelectors.length > 0 ? complexSelectors.join(', ') : null\n    };\n  }\n\n  /**\n   * Scan a specific element or the entire document\n   * Returns an array of scanned references with their DOM elements\n   */\n  scan(rootElement: HTMLElement | Document = document): ScannedReference[] {\n    const references: ScannedReference[] = [];\n    const root = rootElement === document ? document.body : rootElement;\n\n    if (!root) {\n      if (this.config.debug) {\n        console.warn('VerseTagger: No root element found for scanning');\n      }\n      return references;\n    }\n\n    // Use TreeWalker to find text nodes within element nodes\n    // Element nodes allow us to skip entire subtrees efficiently\n    const walker = document.createTreeWalker(\n      root,\n      NodeFilter.SHOW_TEXT | NodeFilter.SHOW_ELEMENT,\n      {\n        acceptNode: (node) => this.shouldScanNode(node)\n      }\n    );\n\n    const textNodesToProcess: Text[] = [];\n    let currentNode: Node | null;\n\n    // Collect all text nodes first to avoid DOM modification during traversal\n    while ((currentNode = walker.nextNode())) {\n      // Only collect text nodes (elements are filtered to skip excluded subtrees)\n      if (currentNode.nodeType === Node.TEXT_NODE) {\n        textNodesToProcess.push(currentNode as Text);\n        if (this.config.debug) {\n          const preview = (currentNode.textContent || '').substring(0, 50).replace(/\\n/g, ' ');\n          const parentTag = (currentNode.parentElement?.tagName || 'none').toLowerCase();\n          console.log(`VerseTagger: [TreeWalker] Found text node in <${parentTag}>: \"${preview}${preview.length >= 50 ? '...' : ''}\"`);\n        }\n      }\n    }\n\n    if (this.config.debug) {\n      console.log(`VerseTagger: [TreeWalker] Collected ${textNodesToProcess.length} text nodes to process`);\n    }\n\n    // Process each text node\n    for (const textNode of textNodesToProcess) {\n      const scanned = this.processTextNode(textNode);\n      references.push(...scanned);\n    }\n\n    if (this.config.debug) {\n      console.log(`VerseTagger: Found ${references.length} references`);\n    }\n\n    return references;\n  }\n\n  /**\n   * Determine if a node should be scanned\n   * For element nodes: returns FILTER_REJECT to skip excluded subtrees\n   * For text nodes: returns FILTER_ACCEPT or FILTER_REJECT\n   */\n  private shouldScanNode(node: Node): number {\n    const debugPrefix = 'VerseTagger: [shouldScanNode]';\n\n    // Handle element nodes - check if they should be excluded\n    if (node.nodeType === Node.ELEMENT_NODE) {\n      const element = node as Element;\n\n      // Check if this element matches exclude selectors\n      // Optimized: Check Sets first (O(1)), then fall back to matches() for complex selectors\n\n      // Fast path: Check tag name\n      if (this.excludedTags.has(element.tagName)) {\n        if (this.config.debug) {\n          console.log(`${debugPrefix} REJECT - Element tag excluded: <${element.tagName.toLowerCase()}>`);\n        }\n        return NodeFilter.FILTER_REJECT;\n      }\n\n      // Fast path: Check ID\n      if (element.id && this.excludedIds.has(element.id)) {\n        if (this.config.debug) {\n          console.log(`${debugPrefix} REJECT - Element ID excluded: #${element.id}`);\n        }\n        return NodeFilter.FILTER_REJECT;\n      }\n\n      // Fast path: Check classes\n      if (element.classList.length > 0) {\n        for (const className of element.classList) {\n          if (this.excludedClasses.has(className)) {\n            if (this.config.debug) {\n              console.log(`${debugPrefix} REJECT - Element class excluded: .${className}`);\n            }\n            return NodeFilter.FILTER_REJECT;\n          }\n        }\n      }\n\n      // Slow path: Check complex selectors (only if they exist)\n      if (this.complexExcludeSelectors) {\n        try {\n          if (element.matches(this.complexExcludeSelectors)) {\n            if (this.config.debug) {\n              console.log(`${debugPrefix} REJECT - Element matches complex excludeSelectors: <${element.tagName.toLowerCase()}>`);\n            }\n            return NodeFilter.FILTER_REJECT;\n          }\n        } catch (e) {\n          if (this.config.debug) {\n            console.warn('VerseTagger: Invalid excludeSelectors', e);\n          }\n        }\n      }\n\n      // Check if this element is already a verse reference (skip its subtree)\n      if (element.classList.contains(this.config.referenceClass)) {\n        if (this.config.debug) {\n          console.log(`${debugPrefix} REJECT - Element is existing verse reference`);\n        }\n        return NodeFilter.FILTER_REJECT;\n      }\n\n      // Check if element is hidden (skip its entire subtree for better performance)\n      if (element instanceof HTMLElement) {\n        const style = window.getComputedStyle(element);\n\n        // Skip if display is none\n        if (style.display === 'none') {\n          if (this.config.debug) {\n            console.log(`${debugPrefix} REJECT - Element has display:none: <${element.tagName.toLowerCase()}>`);\n          }\n          return NodeFilter.FILTER_REJECT;\n        }\n\n        // Skip if visibility is hidden\n        if (style.visibility === 'hidden') {\n          if (this.config.debug) {\n            console.log(`${debugPrefix} REJECT - Element has visibility:hidden: <${element.tagName.toLowerCase()}>`);\n          }\n          return NodeFilter.FILTER_REJECT;\n        }\n\n        // Skip contenteditable elements\n        if (element.getAttribute('contenteditable') === 'true') {\n          if (this.config.debug) {\n            console.log(`${debugPrefix} REJECT - Element has contenteditable=\"true\": <${element.tagName.toLowerCase()}>`);\n          }\n          return NodeFilter.FILTER_REJECT;\n        }\n\n        // Skip aria-hidden elements\n        if (element.getAttribute('aria-hidden') === 'true') {\n          if (this.config.debug) {\n            console.log(`${debugPrefix} REJECT - Element has aria-hidden=\"true\": <${element.tagName.toLowerCase()}>`);\n          }\n          return NodeFilter.FILTER_REJECT;\n        }\n      }\n\n      // Skip element nodes themselves but continue traversing their children\n      // We don't need to collect element nodes, only text nodes\n      return NodeFilter.FILTER_SKIP;\n    }\n\n    // Handle text nodes\n    // Skip if already scanned\n    if (this.scannedNodes.has(node)) {\n      if (this.config.debug) {\n        console.log(`${debugPrefix} REJECT - Already scanned`);\n      }\n      return NodeFilter.FILTER_REJECT;\n    }\n\n    // Skip if the text is empty or only whitespace\n    if (!node.textContent || node.textContent.trim().length === 0) {\n      if (this.config.debug) {\n        console.log(`${debugPrefix} REJECT - Empty or whitespace only`);\n      }\n      return NodeFilter.FILTER_REJECT;\n    }\n\n    // Check if parent exists\n    const parent = node.parentElement;\n    if (!parent) {\n      if (this.config.debug) {\n        console.log(`${debugPrefix} REJECT - No parent element`);\n      }\n      return NodeFilter.FILTER_REJECT;\n    }\n\n    // At this point, we know the parent is not excluded (because excluded elements\n    // would have returned FILTER_SKIP above, preventing us from reaching their text nodes)\n    // So we don't need to check parent.matches() or parent.closest() here\n\n    if (this.config.debug) {\n      console.log(`${debugPrefix} ACCEPT`);\n    }\n    return NodeFilter.FILTER_ACCEPT;\n  }\n\n  /**\n   * Process a single text node and wrap any references found\n   */\n  private processTextNode(textNode: Text): ScannedReference[] {\n    const text = textNode.textContent || '';\n\n    if (this.config.debug) {\n      const preview = text.substring(0, 100).replace(/\\n/g, ' ');\n      console.log(`VerseTagger: [ProcessNode] Text: \"${preview}${text.length > 100 ? '...' : ''}\"`);\n    }\n\n    const references = parseReferences(text);\n\n    if (this.config.debug) {\n      console.log(`VerseTagger: [Regex] Found ${references.length} match(es)`);\n      references.forEach((ref, idx) => {\n        console.log(`VerseTagger: [Match ${idx + 1}] \"${ref.text}\" -> ${ref.book} ${ref.chapter}:${ref.verses}${ref.version ? ' ' + ref.version : ''}`);\n      });\n    }\n\n    if (references.length === 0) {\n      // Mark as scanned even if no references found\n      this.scannedNodes.add(textNode);\n      return [];\n    }\n\n    const scannedRefs: ScannedReference[] = [];\n    const parent = textNode.parentNode;\n\n    if (!parent) {\n      return [];\n    }\n\n    // Process references in reverse order to maintain correct indices\n    const sortedRefs = [...references].sort((a, b) => b.startIndex - a.startIndex);\n\n    if (this.config.debug) {\n      console.log(`VerseTagger: [ProcessNode] Processing ${sortedRefs.length} references in reverse order`);\n    }\n\n    // Keep track of the current text node as we split it\n    let currentTextNode: Text = textNode;\n    let currentText = text;\n\n    for (let i = 0; i < sortedRefs.length; i++) {\n      const ref = sortedRefs[i];\n\n      if (this.config.debug) {\n        console.log(`VerseTagger: [ProcessNode] Processing reference ${i + 1}/${sortedRefs.length}: \"${ref.text}\" at index ${ref.startIndex}-${ref.endIndex}`);\n      }\n\n      const beforeText = currentText.substring(0, ref.startIndex);\n      const refText = currentText.substring(ref.startIndex, ref.endIndex);\n      const afterText = currentText.substring(ref.endIndex);\n\n      // Create the wrapper element for the reference\n      const element = this.createReferenceElement(ref);\n\n      // Split the text node and insert the wrapper\n      if (ref.startIndex === 0) {\n        // Reference is at the start\n        const afterNode = document.createTextNode(afterText);\n        parent.insertBefore(element, currentTextNode);\n        parent.insertBefore(afterNode, currentTextNode);\n        parent.removeChild(currentTextNode);\n\n        // Mark new nodes as scanned\n        this.scannedNodes.add(afterNode);\n\n        // Update current node for next iteration (if processing more refs)\n        currentTextNode = afterNode;\n        currentText = afterText;\n      } else if (ref.endIndex === currentText.length) {\n        // Reference is at the end\n        const beforeNode = document.createTextNode(beforeText);\n        parent.insertBefore(beforeNode, currentTextNode);\n        parent.insertBefore(element, currentTextNode);\n        parent.removeChild(currentTextNode);\n\n        // Mark new nodes as scanned\n        this.scannedNodes.add(beforeNode);\n\n        // Update current node for next iteration (if processing more refs)\n        currentTextNode = beforeNode;\n        currentText = beforeText;\n      } else {\n        // Reference is in the middle\n        const beforeNode = document.createTextNode(beforeText);\n        const afterNode = document.createTextNode(afterText);\n        parent.insertBefore(beforeNode, currentTextNode);\n        parent.insertBefore(element, currentTextNode);\n        parent.insertBefore(afterNode, currentTextNode);\n        parent.removeChild(currentTextNode);\n\n        // Mark new nodes as scanned\n        this.scannedNodes.add(beforeNode);\n        this.scannedNodes.add(afterNode);\n\n        // Update current node for next iteration (continue with the before node since we're going in reverse)\n        currentTextNode = beforeNode;\n        currentText = beforeText;\n      }\n\n      scannedRefs.push({\n        ...ref,\n        element\n      });\n    }\n\n    // Mark the wrapper elements as scanned\n    scannedRefs.forEach(ref => this.scannedNodes.add(ref.element));\n\n    return scannedRefs;\n  }\n\n  /**\n   * Create a wrapper element for a scripture reference\n   */\n  private createReferenceElement(ref: ScriptureReference): HTMLElement {\n    const behavior = this.config.behavior;\n    const shouldBeLink = behavior === 'link-only' || behavior === 'both';\n    const shouldShowModal = behavior === 'modal-only' || behavior === 'both';\n\n    // Create element (link or span based on behavior)\n    const element = document.createElement(shouldBeLink ? 'a' : 'span') as HTMLElement;\n\n    // Set the text content\n    element.textContent = ref.text;\n\n    // Add CSS class\n    element.className = this.config.referenceClass;\n\n    // Store reference data as data attributes for event handlers\n    element.dataset.book = ref.book;\n    element.dataset.chapter = ref.chapter.toString();\n    element.dataset.verses = ref.verses;\n    if (ref.version) {\n      element.dataset.version = ref.version;\n    }\n\n    // If it's a link, set href\n    if (shouldBeLink && element instanceof HTMLAnchorElement) {\n      element.href = this.buildReferenceUrl(ref);\n      if (this.config.openLinksInNewTab) {\n        element.target = '_blank';\n        element.rel = 'noopener noreferrer';\n      }\n    }\n\n    // Add ARIA attributes for accessibility\n    if (shouldShowModal) {\n      element.setAttribute('role', 'button');\n      element.setAttribute('tabindex', '0');\n      element.setAttribute('aria-label', `Show verse: ${ref.text}`);\n\n      if (this.config.accessibility.keyboardNav) {\n        element.setAttribute('aria-haspopup', 'dialog');\n      }\n    }\n\n    // Add data attribute to indicate modal support\n    if (shouldShowModal) {\n      element.dataset.hasModal = 'true';\n    }\n\n    return element;\n  }\n\n  /**\n   * Build a URL for a scripture reference\n   */\n  private buildReferenceUrl(ref: ScriptureReference): string {\n    const versionAbbr = ref.version || this.config.defaultVersion;\n    const versesStr = ref.verses || '';\n\n    // Look up the Bible ID from the version abbreviation\n    const bibleVersion = findVersion(versionAbbr);\n    const bibleId = bibleVersion ? bibleVersion.id.toString() : '111'; // Default to NIV (111) if not found\n\n    return this.config.linkFormat\n      .replace('{book}', ref.book)\n      .replace('{chapter}', ref.chapter.toString())\n      .replace('{verses}', versesStr)\n      .replace('{version}', bibleId);\n  }\n\n  /**\n   * Clear the scanned nodes cache\n   * Useful when re-scanning the same content\n   */\n  clearCache(): void {\n    this.scannedNodes = new WeakSet();\n  }\n}\n", "/**\n * YouVersion API client\n * Handles communication with YouVersion API through user-provided proxy\n */\n\nimport type { ScriptureReference } from '../parser/reference-parser';\nimport { findBook } from '../parser/book-mappings';\n\n/**\n * Verse content from API\n */\nexport interface VerseContent {\n  /** Book code (e.g., \"GEN\", \"MAT\") */\n  book: string;\n  /** Chapter number */\n  chapter: number;\n  /** Verse text content from API */\n  content: string;\n  /** Verse range string (e.g., \"1-3\", \"1,3,5-7\") */\n  verses: string;\n  /** Bible version used */\n  version: string;\n  /** Human-readable reference (e.g., \"John 3:16\") */\n  reference: string;\n  /** Flag indicating this is an error message (for styling) */\n  isError?: boolean;\n}\n\n/**\n * API error types\n */\nexport class ApiError extends Error {\n  constructor(\n    message: string,\n    public statusCode?: number,\n    public cause?: unknown\n  ) {\n    super(message);\n    this.name = 'ApiError';\n  }\n}\n\n/**\n * Parse error message from YouVersion API response\n * Handles two formats:\n * 1. {\"message\": \"Access denied for 116\"}\n * 2. {\"fault\": {\"faultstring\": \"Invalid ApiKey\", \"detail\": {...}}}\n */\nfunction parseApiErrorMessage(responseBody: any): string | null {\n  try {\n    // Handle format 1: {\"message\": \"...\"}\n    if (responseBody?.message) {\n      return responseBody.message;\n    }\n    // Handle format 2: {\"fault\": {\"faultstring\": \"...\"}}\n    if (responseBody?.fault?.faultstring) {\n      return responseBody.fault.faultstring;\n    }\n  } catch {\n    // Ignore parsing errors\n  }\n  return null;\n}\n\n/**\n * YouVersion API client configuration\n */\nexport interface YouVersionClientConfig {\n  /** Proxy URL that forwards requests to YouVersion */\n  proxyUrl: string;\n  /** Default Bible version */\n  defaultVersion: string;\n  /** Request timeout in milliseconds */\n  timeout?: number;\n  /** Enable debug logging */\n  debug?: boolean;\n}\n\n/**\n * YouVersion API client\n * Fetches verse content through a user-provided proxy server\n */\nexport class YouVersionClient {\n  private config: Required<YouVersionClientConfig>;\n\n  constructor(config: YouVersionClientConfig) {\n    this.config = {\n      timeout: 10000, // 10 seconds default\n      debug: false,\n      ...config\n    };\n  }\n\n  /**\n   * Fetch verse content for a scripture reference\n   */\n  async fetchVerse(reference: ScriptureReference): Promise<VerseContent> {\n    const version = reference.version || this.config.defaultVersion;\n\n    // Build request parameters\n    const params = {\n      book: reference.book,\n      chapter: reference.chapter.toString(),\n      verses: reference.verses || undefined,\n      version: version\n    };\n\n    if (this.config.debug) {\n      console.log('[YouVersionClient] Fetching verse:', params);\n    }\n\n    try {\n      const response = await this.makeRequest(params);\n      return this.parseResponse(response, reference, version);\n    } catch (error) {\n      if (error instanceof ApiError) {\n        throw error;\n      }\n      throw new ApiError(\n        `Failed to fetch verse: ${error instanceof Error ? error.message : 'Unknown error'}`,\n        undefined,\n        error\n      );\n    }\n  }\n\n  /**\n   * Make HTTP request to proxy\n   */\n  private async makeRequest(params: Record<string, string | undefined>): Promise<any> {\n    // Build query string\n    const queryParams = new URLSearchParams();\n    for (const [key, value] of Object.entries(params)) {\n      if (value !== undefined) {\n        queryParams.append(key, value);\n      }\n    }\n\n    const url = `${this.config.proxyUrl}?${queryParams.toString()}`;\n\n    if (this.config.debug) {\n      console.log('[YouVersionClient] Request URL:', url);\n      console.log('[YouVersionClient] Request params:', params);\n    }\n\n    // Create abort controller for timeout\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), this.config.timeout);\n\n    try {\n      const response = await fetch(url, {\n        method: 'GET',\n        headers: {\n          'Accept': 'application/json'\n        },\n        signal: controller.signal\n      });\n\n      console.log(response);\n\n      clearTimeout(timeoutId);\n\n      // Handle HTTP errors\n      if (!response.ok) {\n        // Attempt to parse API error message from response body\n        let apiMessage: string | null = null;\n        try {\n          const errorBody = await response.json();\n          apiMessage = parseApiErrorMessage(errorBody);\n        } catch {\n          // Fall back to text response if JSON parsing fails\n          try {\n            const errorText = await response.text();\n            if (errorText && errorText !== 'No error details') {\n              apiMessage = errorText;\n            }\n          } catch {\n            // Ignore text parsing errors\n          }\n        }\n\n        if (response.status === 404) {\n          throw new ApiError(\n            apiMessage || 'Verse not found. The reference may be invalid or not available in this version.',\n            404\n          );\n        }\n\n        if (response.status === 429) {\n          throw new ApiError(\n            apiMessage || 'Rate limit exceeded. Please try again later.',\n            429\n          );\n        }\n\n        throw new ApiError(\n          apiMessage || `API request failed: ${response.status} ${response.statusText}`,\n          response.status\n        );\n      }\n\n      // Parse JSON response\n      const data = await response.json();\n      return data;\n    } catch (error) {\n      clearTimeout(timeoutId);\n\n      // Handle abort/timeout\n      if (error instanceof Error && error.name === 'AbortError') {\n        throw new ApiError(\n          \"Request timed out. Try again in a few seconds.\",\n          undefined,\n          error\n        );\n      }\n\n      // Handle network errors\n      if (error instanceof TypeError && error.message.includes('fetch')) {\n        throw new ApiError(\n          `Network error: Unable to connect to proxy server at ${this.config.proxyUrl}`,\n          undefined,\n          error\n        );\n      }\n\n      throw error;\n    }\n  }\n\n  /**\n   * Parse API response into normalized format\n   */\n  private parseResponse(\n    data: any,\n    reference: ScriptureReference,\n    version: string\n  ): VerseContent {\n    // Validate response structure\n    if (!data || typeof data !== 'object') {\n      throw new ApiError('Invalid API response: Expected JSON object');\n    }\n\n    if (this.config.debug) {\n      console.log('[YouVersionClient] Proxy response:', JSON.stringify(data, null, 2));\n      console.log('[YouVersionClient] Requested version:', version);\n      console.log('[YouVersionClient] Content preview:', data.content?.substring(0, 100));\n    }\n\n    // The proxy should return data in the format:\n    // { id: \"GEN.1.1\", content: \"In the beginning...\", reference: \"Genesis 1:1\" }\n    // The content field contains all requested verses combined (without verse numbers)\n\n    if (!data.content || typeof data.content !== 'string') {\n      throw new ApiError(`Invalid API response: Expected 'content' field with verse text. Got: ${JSON.stringify(data)}`);\n    }\n\n    // Format the reference for display\n    let displayReference: string;\n    if (data.reference) {\n      // API provided a reference, but it might use book codes - replace with full name\n      const bookInfo = findBook(reference.book);\n      if (bookInfo) {\n        // Replace the book code with the full book name in the API's reference\n        displayReference = data.reference.replace(new RegExp(`^${reference.book}\\\\b`), bookInfo.name);\n      } else {\n        displayReference = data.reference;\n      }\n    } else {\n      // Format our own reference\n      displayReference = this.formatReference(reference, version);\n    }\n\n    // Return the content directly without wrapping in verse objects\n    return {\n      book: reference.book,\n      chapter: reference.chapter,\n      content: data.content,\n      verses: reference.verses,\n      version: version, // Use the requested version, not the API's version\n      reference: displayReference\n    };\n  }\n\n  /**\n   * Format reference for display if not provided by API\n   */\n  private formatReference(ref: ScriptureReference, version: string): string {\n    // Get full book name for display\n    const bookInfo = findBook(ref.book);\n    const displayBookName = bookInfo ? bookInfo.name : ref.book;\n\n    let result = `${displayBookName} ${ref.chapter}`;\n\n    if (ref.verses) {\n      result += `:${ref.verses}`;\n    }\n\n    result += ` ${version}`;\n    return result;\n  }\n\n  /**\n   * Update client configuration\n   */\n  updateConfig(config: Partial<YouVersionClientConfig>): void {\n    this.config = {\n      ...this.config,\n      ...config\n    };\n  }\n}\n", "/**\n * Modal Styles\n * Base CSS for modal system with mobile responsiveness\n * Uses CSS variables from the theming system (--vt-* prefix)\n */\n\nexport const MODAL_BASE_STYLES = `\n/* Modal Container */\n.versetagger-modal {\n  position: absolute;\n  z-index: 999999;\n  background: var(--vt-modalBackground);\n  border: 1px solid var(--vt-modalBorder);\n  border-radius: var(--vt-modalBorderRadius);\n  box-shadow: 0 4px 6px -1px var(--vt-modalShadow), 0 2px 4px -1px var(--vt-modalShadow);\n  max-width: var(--vt-modalMaxWidth);\n  min-width: 280px;\n  width: 90vw;\n  /* Constrain to 80vh or full viewport minus padding, whichever is smaller (JS+CSS dual constraint) */\n  max-height: min(80vh, calc(100vh - 32px));\n  overflow-y: auto;\n  overflow-x: visible; /* Allow bridge to extend outside */\n  opacity: 0;\n  transform: translateY(-8px);\n  transition: opacity 0.2s ease, transform 0.2s ease;\n  font-family: var(--vt-fontFamily);\n  font-size: var(--vt-fontSize);\n  line-height: var(--vt-lineHeight);\n  color: var(--vt-textPrimary);\n  padding: var(--vt-modalPadding);\n}\n\n/* Modal visible state */\n.versetagger-modal-visible {\n  opacity: 1;\n  transform: translateY(0);\n}\n\n/* Modal placement variants */\n.versetagger-modal[data-placement=\"below\"] {\n  transform-origin: top center;\n}\n\n.versetagger-modal[data-placement=\"above\"] {\n  transform-origin: bottom center;\n}\n\n/* Invisible bridge that connects trigger to modal */\n.versetagger-modal-bridge {\n  position: absolute;\n  pointer-events: auto;\n  z-index: 999998; /* Just below modal (999999) but above page content */\n  /* Dimensions set via JS based on modal position */\n}\n\n/* Close Button */\n.versetagger-modal-close {\n  position: absolute;\n  top: 12px;\n  right: 12px;\n  background: var(--vt-closeButtonBackground);\n  border: none;\n  font-size: 28px;\n  line-height: 1;\n  color: var(--vt-closeButtonColor);\n  cursor: pointer;\n  padding: 4px;\n  width: 32px;\n  height: 32px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  border-radius: 4px;\n  transition: background-color 0.2s ease, color 0.2s ease;\n  z-index: 10;\n}\n\n.versetagger-modal-close:hover {\n  background-color: var(--vt-closeButtonHoverBackground);\n  color: var(--vt-closeButtonHoverColor);\n}\n\n.versetagger-modal-close:focus {\n  outline: 2px solid var(--vt-linkColor);\n  outline-offset: 2px;\n}\n\n/* Header */\n.versetagger-modal-header {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  margin-bottom: 16px;\n  padding-right: 32px; /* Make room for close button */\n  flex-wrap: nowrap;\n}\n\n.versetagger-modal-reference {\n  margin: 0;\n  font-size: 18px;\n  font-weight: 600;\n  color: var(--vt-textPrimary);\n  flex-shrink: 1;\n  min-width: 0;\n}\n\n.versetagger-modal-version {\n  display: inline-block;\n  padding: 4px 10px;\n  background: var(--vt-modalBorder);\n  color: var(--vt-textMuted);\n  border-radius: 4px;\n  font-size: 13px;\n  font-weight: 500;\n  white-space: nowrap;\n  flex-shrink: 0;\n}\n\n/* Verses Container */\n.versetagger-modal-verses {\n  margin-bottom: 16px;\n}\n\n.versetagger-modal-verse {\n  display: flex;\n  gap: 8px;\n  margin-bottom: 12px;\n  align-items: flex-start;\n}\n\n.versetagger-modal-verse:last-child {\n  margin-bottom: 0;\n}\n\n.versetagger-verse-number {\n  flex-shrink: 0;\n  font-weight: 700;\n  color: var(--vt-verseNumberColor);\n  font-size: var(--vt-verseNumberSize);\n  min-width: 24px;\n  text-align: right;\n  line-height: inherit;\n}\n\n.versetagger-verse-text {\n  flex: 1;\n  color: var(--vt-textSecondary);\n}\n\n/* Content Text (for plain text display) */\n.versetagger-content-text {\n  margin: 0 0 16px 0;\n  color: var(--vt-textSecondary);\n  font-size: 14px;\n  line-height: 1.6;\n}\n\n/* Content Text (error state) */\n.versetagger-content-text.versetagger-content-error {\n  color: var(--vt-errorText);\n}\n\n/* Footer */\n.versetagger-modal-footer {\n  padding-top: 12px;\n  border-top: 1px solid var(--vt-modalBorder);\n  display: flex;\n  justify-content: flex-end;\n}\n\n.versetagger-youversion-link {\n  display: inline-flex;\n  align-items: center;\n  color: var(--vt-linkColor);\n  text-decoration: none;\n  font-size: 14px;\n  font-weight: 500;\n  transition: color 0.2s ease;\n}\n\n.versetagger-youversion-link:hover {\n  color: var(--vt-linkHoverColor);\n}\n\n.versetagger-youversion-link:focus {\n  outline: 2px solid var(--vt-linkColor);\n  outline-offset: 2px;\n  border-radius: 2px;\n}\n\n.versetagger-external-icon {\n  font-size: 12px;\n  opacity: 0.7;\n}\n\n/* Loading State */\n.versetagger-modal-loading {\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n  padding: 32px;\n  gap: 12px;\n}\n\n.versetagger-spinner {\n  width: 32px;\n  height: 32px;\n  border: 3px solid var(--vt-modalBorder);\n  border-top-color: var(--vt-loadingColor);\n  border-radius: 50%;\n  animation: versetagger-spin 0.8s linear infinite;\n}\n\n@keyframes versetagger-spin {\n  to {\n    transform: rotate(360deg);\n  }\n}\n\n/* Error State */\n.versetagger-modal-error {\n  display: flex;\n  align-items: flex-start;\n  gap: 12px;\n  padding: 16px;\n}\n\n.versetagger-error-icon {\n  font-size: 20px;\n  flex-shrink: 0;\n  color: var(--vt-errorText);\n}\n\n.versetagger-error-message {\n  margin: 0;\n  color: var(--vt-errorText);\n  font-size: 14px;\n  line-height: 1.5;\n}\n\n/* Screen Reader Only */\n.versetagger-sr-only {\n  position: absolute;\n  width: 1px;\n  height: 1px;\n  padding: 0;\n  margin: -1px;\n  overflow: hidden;\n  clip: rect(0, 0, 0, 0);\n  white-space: nowrap;\n  border-width: 0;\n}\n\n/* Mobile Responsiveness */\n@media (max-width: 640px) {\n  .versetagger-modal {\n    max-width: calc(100vw - 32px);\n    width: calc(100vw - 32px);\n    max-height: 85vh;\n    font-size: 15px;\n  }\n\n  .versetagger-modal-content {\n    padding: 16px;\n  }\n\n  .versetagger-modal-close {\n    top: 8px;\n    right: 8px;\n    font-size: 24px;\n    width: 28px;\n    height: 28px;\n  }\n\n  .versetagger-modal-header {\n    padding-right: 28px;\n    margin-bottom: 12px;\n  }\n\n  .versetagger-modal-reference {\n    font-size: 16px;\n  }\n\n  .versetagger-modal-version {\n    font-size: 12px;\n    padding: 3px 8px;\n  }\n\n  .versetagger-verse-number {\n    font-size: 13px;\n    min-width: 20px;\n  }\n\n  .versetagger-modal-verse {\n    gap: 6px;\n    margin-bottom: 10px;\n  }\n}\n\n/* Touch-friendly interactions on mobile */\n@media (hover: none) and (pointer: coarse) {\n  .versetagger-modal-close {\n    min-width: 44px;\n    min-height: 44px;\n  }\n\n  .versetagger-youversion-link {\n    padding: 8px 0;\n    min-height: 44px;\n    display: inline-flex;\n    align-items: center;\n  }\n}\n\n/* Modal open class - reserved for future use if needed */\nbody.versetagger-modal-open {\n  /* No styles needed - modal scrolls naturally with page content */\n}\n\n/* High contrast mode support */\n@media (prefers-contrast: high) {\n  .versetagger-modal {\n    border-width: 2px;\n  }\n\n  .versetagger-modal-close:focus,\n  .versetagger-youversion-link:focus {\n    outline-width: 3px;\n  }\n}\n\n/* Reduced motion support */\n@media (prefers-reduced-motion: reduce) {\n  .versetagger-modal,\n  .versetagger-modal-close,\n  .versetagger-youversion-link {\n    transition: none;\n  }\n\n  .versetagger-spinner {\n    animation: none;\n    border-top-color: var(--vt-modalBorder);\n  }\n}\n`;\n\n/**\n * Inject modal styles into the document\n */\nexport function injectModalStyles(): void {\n  // Check if styles already injected\n  if (document.getElementById('versetagger-modal-styles')) {\n    return;\n  }\n\n  const styleEl = document.createElement('style');\n  styleEl.id = 'versetagger-modal-styles';\n  styleEl.textContent = MODAL_BASE_STYLES;\n  document.head.appendChild(styleEl);\n}\n\n/**\n * Remove modal styles from the document\n */\nexport function removeModalStyles(): void {\n  const styleEl = document.getElementById('versetagger-modal-styles');\n  if (styleEl) {\n    styleEl.remove();\n  }\n}\n", "/**\n * Modal Manager\n * Manages modal lifecycle, positioning, and accessibility\n */\n\nimport type { VersetaggerConfig } from '../core/config';\nimport type { VerseContent } from '../api/youversion-client';\nimport { injectModalStyles, removeModalStyles } from './modal-styles';\n\nexport type ModalState = 'hidden' | 'loading' | 'loaded' | 'error';\n\nexport interface ModalPosition {\n  top: number;\n  left: number;\n  placement: 'above' | 'below';\n}\n\n/**\n * Modal manager for scripture verse display\n */\nexport class ModalManager {\n  private config: Required<VersetaggerConfig>;\n  private modalElement: HTMLElement | null = null;\n  private containerElement: HTMLElement | null = null;\n  private bridgeElement: HTMLElement | null = null;\n  private currentTarget: HTMLElement | null = null;\n  private currentState: ModalState = 'hidden';\n  private renderCallback: ((container: HTMLElement, content: VerseContent) => void) | null = null;\n  private focusBeforeModal: HTMLElement | null = null;\n\n  constructor(config: Required<VersetaggerConfig>) {\n    this.config = config;\n  }\n\n  /**\n   * Initialize the modal system (lazy - modal created on first use)\n   */\n  initialize(renderCallback: (container: HTMLElement, content: VerseContent) => void): void {\n    this.renderCallback = renderCallback;\n    // Note: Modal container and styles are created lazily on first show\n    // This reduces initial page load impact\n  }\n\n  /**\n   * Ensure modal is created (lazy initialization)\n   * This is called on first use to minimize initial page load impact\n   */\n  private ensureModalCreated(): void {\n    if (this.modalElement) {\n      return; // Already created\n    }\n\n    // Inject styles on first use\n    injectModalStyles();\n\n    // Create container outside main DOM\n    this.modalElement = document.createElement('div');\n    this.modalElement.id = 'versetagger-modal';\n    this.modalElement.className = 'versetagger-modal';\n    this.modalElement.setAttribute('role', 'dialog');\n    this.modalElement.setAttribute('aria-modal', 'true');\n    this.modalElement.setAttribute('aria-label', 'Scripture verse content');\n    this.modalElement.style.display = 'none';\n\n    // Create inner container for content\n    this.containerElement = document.createElement('div');\n    this.containerElement.className = 'versetagger-modal-content';\n    this.modalElement.appendChild(this.containerElement);\n\n    // Add close button for accessibility and mobile\n    const closeButton = document.createElement('button');\n    closeButton.className = 'versetagger-modal-close';\n    closeButton.setAttribute('aria-label', 'Close modal');\n    closeButton.innerHTML = '&times;';\n    closeButton.addEventListener('click', () => this.hide());\n    this.modalElement.appendChild(closeButton);\n\n    // Append modal to body\n    document.body.appendChild(this.modalElement);\n\n    // Create invisible bridge element as a sibling (separate element)\n    this.bridgeElement = document.createElement('div');\n    this.bridgeElement.className = 'versetagger-modal-bridge';\n    this.bridgeElement.style.display = 'none';\n    document.body.appendChild(this.bridgeElement);\n\n    // Attach global listeners (only once)\n    this.attachGlobalListeners();\n  }\n\n  /**\n   * Attach global event listeners\n   */\n  private attachGlobalListeners(): void {\n    // Close on Escape key\n    document.addEventListener('keydown', (event) => {\n      if (event.key === 'Escape' && this.currentState !== 'hidden') {\n        this.hide();\n      }\n    });\n\n    // Close when clicking outside modal\n    document.addEventListener('click', (event) => {\n      if (this.currentState !== 'hidden' && this.modalElement) {\n        const target = event.target as Node;\n        // Don't close if clicking on the modal itself or the trigger element\n        if (\n          !this.modalElement.contains(target) &&\n          this.currentTarget &&\n          !this.currentTarget.contains(target)\n        ) {\n          this.hide();\n        }\n      }\n    });\n\n    // Handle hover on modal to prevent premature closing\n    // This works with EventHandler's mouseLeaveTimeout\n    if (this.modalElement) {\n      this.modalElement.addEventListener('mouseenter', () => {\n        // Modal is being hovered - signal we're in the modal region\n        this.modalElement?.setAttribute('data-modal-hovered', 'true');\n      });\n\n      this.modalElement.addEventListener('mouseleave', () => {\n        // Left the modal\n        this.modalElement?.removeAttribute('data-modal-hovered');\n\n        // Close after small delay if trigger and bridge are also not hovered\n        setTimeout(() => {\n          if (\n            this.modalElement?.getAttribute('data-modal-hovered') !== 'true' &&\n            this.bridgeElement?.getAttribute('data-bridge-hovered') !== 'true' &&\n            this.currentTarget &&\n            !this.currentTarget.matches(':hover')\n          ) {\n            this.hide();\n          }\n        }, 100);\n      });\n    }\n\n    // Handle hover on bridge to prevent premature closing\n    if (this.bridgeElement) {\n      this.bridgeElement.addEventListener('mouseenter', () => {\n        // Bridge is being hovered - signal we're in the bridge region\n        this.bridgeElement?.setAttribute('data-bridge-hovered', 'true');\n        // Also set modal hovered so EventHandler doesn't close\n        this.modalElement?.setAttribute('data-modal-hovered', 'true');\n      });\n\n      this.bridgeElement.addEventListener('mouseleave', () => {\n        // Left the bridge\n        this.bridgeElement?.removeAttribute('data-bridge-hovered');\n        this.modalElement?.removeAttribute('data-modal-hovered');\n\n        // Close after small delay if modal and trigger are also not hovered\n        setTimeout(() => {\n          if (\n            this.modalElement?.getAttribute('data-modal-hovered') !== 'true' &&\n            this.bridgeElement?.getAttribute('data-bridge-hovered') !== 'true' &&\n            this.currentTarget &&\n            !this.currentTarget.matches(':hover')\n          ) {\n            this.hide();\n          }\n        }, 100);\n      });\n    }\n\n    // Handle window resize - reposition modal\n    window.addEventListener('resize', () => {\n      if (this.currentState !== 'hidden' && this.currentTarget) {\n        this.position(this.currentTarget);\n      }\n    });\n\n    // Handle scroll - reposition modal\n    window.addEventListener('scroll', () => {\n      if (this.currentState !== 'hidden' && this.currentTarget) {\n        this.position(this.currentTarget);\n      }\n    }, { passive: true });\n  }\n\n  /**\n   * Show modal in loading state\n   */\n  showLoading(targetElement: HTMLElement): void {\n    // Ensure modal is created (lazy initialization)\n    this.ensureModalCreated();\n\n    if (!this.modalElement || !this.containerElement) {\n      return;\n    }\n\n    // Store focus before opening modal\n    this.focusBeforeModal = document.activeElement as HTMLElement;\n\n    // Add modal open class (currently unused, but may be needed for future features)\n    document.body.classList.add('versetagger-modal-open');\n\n    this.currentTarget = targetElement;\n    this.currentState = 'loading';\n\n    // Clear previous content\n    this.containerElement.innerHTML = '';\n\n    // Show loading spinner\n    const loadingEl = document.createElement('div');\n    loadingEl.className = 'versetagger-modal-loading';\n    loadingEl.setAttribute('role', 'status');\n    loadingEl.setAttribute('aria-live', 'polite');\n    loadingEl.innerHTML = `\n      <div class=\"versetagger-spinner\"></div>\n      <span class=\"versetagger-sr-only\">Loading verse content...</span>\n    `;\n    this.containerElement.appendChild(loadingEl);\n\n    // Position and show modal\n    this.position(targetElement);\n    this.modalElement.style.display = 'block';\n    this.modalElement.classList.add('versetagger-modal-visible');\n\n    // Show and position bridge\n    if (this.bridgeElement) {\n      this.bridgeElement.style.display = 'block';\n      this.positionBridge(targetElement);\n    }\n\n    // Announce to screen readers\n    if (this.config.accessibility.announceToScreenReaders) {\n      this.announce('Loading verse content');\n    }\n  }\n\n  /**\n   * Show modal with verse content\n   */\n  showContent(content: VerseContent): void {\n    if (!this.modalElement || !this.containerElement || !this.renderCallback) {\n      return;\n    }\n\n    this.currentState = 'loaded';\n\n    // Clear loading state\n    this.containerElement.innerHTML = '';\n\n    // Render content using callback\n    this.renderCallback(this.containerElement, content);\n\n    // Reposition modal now that actual content is rendered (height may have changed)\n    if (this.currentTarget) {\n      this.position(this.currentTarget);\n      // Update bridge position as well\n      if (this.bridgeElement && this.bridgeElement.style.display === 'block') {\n        this.positionBridge(this.currentTarget);\n      }\n    }\n\n    // Announce to screen readers\n    if (this.config.accessibility.announceToScreenReaders) {\n      this.announce(`Loaded ${content.reference}`);\n    }\n  }\n\n  /**\n   * Show modal with error message\n   */\n  showError(message: string): void {\n    if (!this.modalElement || !this.containerElement) {\n      return;\n    }\n\n    this.currentState = 'error';\n\n    // Clear previous content\n    this.containerElement.innerHTML = '';\n\n    // Show error message\n    const errorEl = document.createElement('div');\n    errorEl.className = 'versetagger-modal-error';\n    errorEl.setAttribute('role', 'alert');\n    errorEl.innerHTML = `\n      <p class=\"versetagger-error-message\">${this.escapeHtml(message)}</p>\n    `;\n    this.containerElement.appendChild(errorEl);\n\n    // Reposition modal now that error content is rendered\n    if (this.currentTarget) {\n      this.position(this.currentTarget);\n      // Update bridge position as well\n      if (this.bridgeElement && this.bridgeElement.style.display === 'block') {\n        this.positionBridge(this.currentTarget);\n      }\n    }\n\n    // Announce to screen readers\n    if (this.config.accessibility.announceToScreenReaders) {\n      this.announce(`Error: ${message}`);\n    }\n  }\n\n  /**\n   * Hide modal\n   */\n  hide(): void {\n    if (!this.modalElement) {\n      return;\n    }\n\n    this.currentState = 'hidden';\n    this.modalElement.classList.remove('versetagger-modal-visible');\n\n    // Hide bridge\n    if (this.bridgeElement) {\n      this.bridgeElement.style.display = 'none';\n    }\n\n    // Remove modal open class\n    document.body.classList.remove('versetagger-modal-open');\n\n    // Wait for transition to complete before hiding\n    setTimeout(() => {\n      if (this.modalElement && this.currentState === 'hidden') {\n        this.modalElement.style.display = 'none';\n      }\n    }, 200); // Match CSS transition duration\n\n    // Restore focus\n    if (this.focusBeforeModal && this.config.accessibility.keyboardNav) {\n      this.focusBeforeModal.focus();\n      this.focusBeforeModal = null;\n    }\n\n    this.currentTarget = null;\n  }\n\n  /**\n   * Position modal relative to target element\n   * Smart positioning algorithm: prefer below, fallback to above, prevent viewport overflow\n   */\n  private position(targetElement: HTMLElement): void {\n    if (!this.modalElement) {\n      return;\n    }\n\n    const targetRect = targetElement.getBoundingClientRect();\n    const modalRect = this.modalElement.getBoundingClientRect();\n    const viewportWidth = window.innerWidth;\n    const viewportHeight = window.innerHeight;\n\n    const spacing = 8; // Pixels between target and modal\n    const horizontalPadding = 16; // Minimum padding from viewport edge\n    const verticalPadding = 16; // Minimum padding from viewport edge\n\n    let placement: 'above' | 'below' = 'below';\n    let top = 0;\n    let left = 0;\n\n    // Calculate vertical position with viewport padding\n    const spaceBelow = viewportHeight - targetRect.bottom - verticalPadding;\n    const spaceAbove = targetRect.top - verticalPadding;\n    const modalWithSpacing = modalRect.height + spacing;\n\n    // Determine placement based on where modal actually fits\n    if (spaceBelow >= modalWithSpacing) {\n      // Fits comfortably below\n      placement = 'below';\n      top = targetRect.bottom + spacing + window.scrollY;\n    } else if (spaceAbove >= modalWithSpacing) {\n      // Fits comfortably above\n      placement = 'above';\n      top = targetRect.top - modalRect.height - spacing + window.scrollY;\n    } else if (spaceBelow > spaceAbove) {\n      // Doesn't fit either place, but more space below\n      placement = 'below';\n      top = targetRect.bottom + spacing + window.scrollY;\n    } else {\n      // Doesn't fit either place, but more space above\n      placement = 'above';\n      top = targetRect.top - modalRect.height - spacing + window.scrollY;\n    }\n\n    // Constrain modal to viewport bounds (prevent bottom overflow)\n    const modalBottom = top - window.scrollY + modalRect.height;\n    const maxBottom = viewportHeight - verticalPadding;\n\n    if (modalBottom > maxBottom) {\n      // Modal overflows bottom - shift it up\n      const overflow = modalBottom - maxBottom;\n      top -= overflow;\n\n      // Ensure we don't push it above viewport top\n      const minTop = verticalPadding + window.scrollY;\n      if (top < minTop) {\n        top = minTop;\n        // CSS max-height: 80vh and overflow-y: auto will handle scrolling\n      }\n    }\n\n    // Ensure target element remains visible after constraining\n    const modalTop = top - window.scrollY;\n    const modalBottomViewport = modalTop + modalRect.height;\n\n    if (placement === 'above' && modalBottomViewport > targetRect.top - spacing) {\n      // Modal was pushed down and now covers the target\n      // Shift it up to maintain spacing, even if it clips top\n      const targetTop = targetRect.top - spacing;\n      top = targetTop - modalRect.height + window.scrollY;\n    }\n\n    // Calculate horizontal position (center on target, but prevent overflow)\n    const targetCenter = targetRect.left + targetRect.width / 2;\n    const modalHalfWidth = modalRect.width / 2;\n\n    left = targetCenter - modalHalfWidth;\n\n    // Prevent overflow on left edge\n    if (left < horizontalPadding) {\n      left = horizontalPadding;\n    }\n\n    // Prevent overflow on right edge\n    if (left + modalRect.width > viewportWidth - horizontalPadding) {\n      left = viewportWidth - modalRect.width - horizontalPadding;\n    }\n\n    // Apply position\n    this.modalElement.style.top = `${top}px`;\n    this.modalElement.style.left = `${left + window.scrollX}px`;\n    this.modalElement.setAttribute('data-placement', placement);\n\n    // Update bridge position if visible\n    if (this.bridgeElement && this.bridgeElement.style.display === 'block' && this.currentTarget) {\n      this.positionBridge(this.currentTarget);\n    }\n  }\n\n  /**\n   * Position the invisible bridge between trigger and modal\n   */\n  private positionBridge(targetElement: HTMLElement): void {\n    if (!this.bridgeElement || !this.modalElement) {\n      return;\n    }\n\n    const targetRect = targetElement.getBoundingClientRect();\n    const modalRect = this.modalElement.getBoundingClientRect();\n    const placement = this.modalElement.getAttribute('data-placement');\n\n    if (placement === 'below') {\n      // Modal is below trigger - bridge covers ONLY the gap between trigger bottom and modal top\n      const bridgeTop = targetRect.bottom + window.scrollY;\n      const bridgeHeight = (modalRect.top + window.scrollY) - bridgeTop;\n      const bridgeLeft = Math.min(targetRect.left, modalRect.left);\n      const bridgeWidth = Math.max(targetRect.right, modalRect.right) - bridgeLeft;\n\n      this.bridgeElement.style.top = `${bridgeTop}px`;\n      this.bridgeElement.style.left = `${bridgeLeft + window.scrollX}px`;\n      this.bridgeElement.style.width = `${bridgeWidth}px`;\n      this.bridgeElement.style.height = `${bridgeHeight}px`;\n    } else {\n      // Modal is above trigger - bridge covers ONLY the gap between modal bottom and trigger top\n      const bridgeTop = modalRect.bottom + window.scrollY;\n      const bridgeHeight = (targetRect.top + window.scrollY) - bridgeTop;\n      const bridgeLeft = Math.min(targetRect.left, modalRect.left);\n      const bridgeWidth = Math.max(targetRect.right, modalRect.right) - bridgeLeft;\n\n      this.bridgeElement.style.top = `${bridgeTop}px`;\n      this.bridgeElement.style.left = `${bridgeLeft + window.scrollX}px`;\n      this.bridgeElement.style.width = `${bridgeWidth}px`;\n      this.bridgeElement.style.height = `${bridgeHeight}px`;\n    }\n  }\n\n  /**\n   * Get current modal state\n   */\n  getState(): ModalState {\n    return this.currentState;\n  }\n\n  /**\n   * Get current target element\n   */\n  getCurrentTarget(): HTMLElement | null {\n    return this.currentTarget;\n  }\n\n  /**\n   * Check if modal is visible\n   */\n  isVisible(): boolean {\n    return this.currentState !== 'hidden';\n  }\n\n  /**\n   * Announce message to screen readers\n   */\n  private announce(message: string): void {\n    const announcer = document.createElement('div');\n    announcer.className = 'versetagger-sr-only';\n    announcer.setAttribute('role', 'status');\n    announcer.setAttribute('aria-live', 'polite');\n    announcer.textContent = message;\n\n    document.body.appendChild(announcer);\n\n    // Remove after announcement\n    setTimeout(() => {\n      document.body.removeChild(announcer);\n    }, 1000);\n  }\n\n  /**\n   * Escape HTML to prevent XSS\n   */\n  private escapeHtml(text: string): string {\n    const div = document.createElement('div');\n    div.textContent = text;\n    return div.innerHTML;\n  }\n\n  /**\n   * Update configuration\n   */\n  updateConfig(config: Required<VersetaggerConfig>): void {\n    this.config = config;\n  }\n\n  /**\n   * Destroy modal and cleanup\n   */\n  destroy(): void {\n    if (this.modalElement) {\n      this.modalElement.remove();\n      this.modalElement = null;\n      this.containerElement = null;\n      this.bridgeElement = null;\n    }\n    // Remove modal open class\n    document.body.classList.remove('versetagger-modal-open');\n    // Remove injected styles\n    removeModalStyles();\n    this.currentTarget = null;\n    this.currentState = 'hidden';\n    this.renderCallback = null;\n  }\n}\n", "/**\n * Debounce utility\n * Delays execution of a function until after a specified delay has elapsed\n * since the last time it was invoked\n */\n\n/**\n * Debounce a function\n * @param func The function to debounce\n * @param delay Delay in milliseconds\n * @returns Debounced function with cancel method\n */\nexport function debounce<T extends (...args: any[]) => any>(\n  func: T,\n  delay: number\n): T & { cancel: () => void } {\n  let timeoutId: ReturnType<typeof setTimeout> | null = null;\n\n  const debounced = function (this: any, ...args: Parameters<T>) {\n    // Clear existing timeout\n    if (timeoutId !== null) {\n      clearTimeout(timeoutId);\n    }\n\n    // Set new timeout\n    timeoutId = setTimeout(() => {\n      func.apply(this, args);\n      timeoutId = null;\n    }, delay);\n  } as T & { cancel: () => void };\n\n  // Add cancel method\n  debounced.cancel = () => {\n    if (timeoutId !== null) {\n      clearTimeout(timeoutId);\n      timeoutId = null;\n    }\n  };\n\n  return debounced;\n}\n\n/**\n * Throttle a function\n * Ensures function is called at most once per specified interval\n * @param func The function to throttle\n * @param interval Minimum interval in milliseconds between calls\n * @returns Throttled function\n */\nexport function throttle<T extends (...args: any[]) => any>(\n  func: T,\n  interval: number\n): T {\n  let lastCall = 0;\n\n  return function (this: any, ...args: Parameters<T>) {\n    const now = Date.now();\n    if (now - lastCall >= interval) {\n      lastCall = now;\n      func.apply(this, args);\n    }\n  } as T;\n}\n", "/**\n * Event Handler\n * Manages hover, click, and keyboard events for scripture references\n */\n\nimport type { VersetaggerConfig } from '../core/config';\nimport { debounce } from '../utils/debounce';\n\nexport type EventCallback = (element: HTMLElement, event: Event) => void;\n\n/**\n * Event handler for scripture reference interactions\n */\nexport class EventHandler {\n  private config: Required<VersetaggerConfig>;\n  private onOpen: EventCallback;\n  private onClose: EventCallback;\n  private debouncedMouseEnter: ((element: HTMLElement, event: MouseEvent) => void) & { cancel: () => void };\n  private activeElement: HTMLElement | null = null;\n  private mouseLeaveTimeout: ReturnType<typeof setTimeout> | null = null;\n\n  constructor(\n    config: Required<VersetaggerConfig>,\n    onOpen: EventCallback,\n    onClose: EventCallback\n  ) {\n    this.config = config;\n    this.onOpen = onOpen;\n    this.onClose = onClose;\n\n    // Create debounced hover handler\n    this.debouncedMouseEnter = debounce(\n      this.handleDebouncedMouseEnter.bind(this),\n      config.hoverDelay\n    );\n  }\n\n  /**\n   * Attach event listeners to a scripture reference element\n   */\n  attach(element: HTMLElement): void {\n    const hasModal = element.dataset.hasModal === 'true';\n    if (!hasModal) {\n      return; // No modal to show\n    }\n\n    const trigger = this.config.trigger;\n\n    // Attach hover events\n    if (trigger === 'hover' || trigger === 'both') {\n      element.addEventListener('mouseenter', this.handleMouseEnter.bind(this));\n      element.addEventListener('mouseleave', this.handleMouseLeave.bind(this));\n      element.addEventListener('focus', this.handleFocus.bind(this));\n      element.addEventListener('blur', this.handleBlur.bind(this));\n    }\n\n    // Attach click events\n    if (trigger === 'click' || trigger === 'both') {\n      element.addEventListener('click', this.handleClick.bind(this));\n    }\n\n    // Attach keyboard events for accessibility\n    if (this.config.accessibility.keyboardNav) {\n      element.addEventListener('keydown', this.handleKeyDown.bind(this));\n    }\n  }\n\n  /**\n   * Remove all event listeners from an element\n   */\n  detach(element: HTMLElement): void {\n    const hasModal = element.dataset.hasModal === 'true';\n    if (!hasModal) {\n      return;\n    }\n\n    const trigger = this.config.trigger;\n\n    if (trigger === 'hover' || trigger === 'both') {\n      element.removeEventListener('mouseenter', this.handleMouseEnter.bind(this));\n      element.removeEventListener('mouseleave', this.handleMouseLeave.bind(this));\n      element.removeEventListener('focus', this.handleFocus.bind(this));\n      element.removeEventListener('blur', this.handleBlur.bind(this));\n    }\n\n    if (trigger === 'click' || trigger === 'both') {\n      element.removeEventListener('click', this.handleClick.bind(this));\n    }\n\n    if (this.config.accessibility.keyboardNav) {\n      element.removeEventListener('keydown', this.handleKeyDown.bind(this));\n    }\n  }\n\n  /**\n   * Handle mouse enter event (start debounce timer)\n   */\n  private handleMouseEnter(event: Event): void {\n    const element = event.currentTarget as HTMLElement;\n\n    // Cancel any pending close\n    if (this.mouseLeaveTimeout) {\n      clearTimeout(this.mouseLeaveTimeout);\n      this.mouseLeaveTimeout = null;\n    }\n\n    // Start debounced open\n    this.debouncedMouseEnter(element, event as MouseEvent);\n  }\n\n  /**\n   * Handle debounced mouse enter (actually open the modal)\n   */\n  private handleDebouncedMouseEnter(element: HTMLElement, event: MouseEvent): void {\n    this.activeElement = element;\n    this.onOpen(element, event);\n  }\n\n  /**\n   * Handle mouse leave event (close after delay)\n   */\n  private handleMouseLeave(event: Event): void {\n    const element = event.currentTarget as HTMLElement;\n\n    // Cancel pending open\n    this.debouncedMouseEnter.cancel();\n\n    // Only close if this is the active element\n    if (this.activeElement === element) {\n      // Add delay before closing to allow moving to modal\n      // 200ms provides smooth experience with the invisible bridge\n      this.mouseLeaveTimeout = setTimeout(() => {\n        if (this.activeElement === element) {\n          this.onClose(element, event);\n          this.activeElement = null;\n        }\n      }, 200);\n    }\n  }\n\n  /**\n   * Handle focus event (for keyboard navigation)\n   */\n  private handleFocus(event: Event): void {\n    const trigger = this.config.trigger;\n    if (trigger === 'hover' || trigger === 'both') {\n      const element = event.currentTarget as HTMLElement;\n      this.activeElement = element;\n      this.onOpen(element, event);\n    }\n  }\n\n  /**\n   * Handle blur event\n   */\n  private handleBlur(event: Event): void {\n    const trigger = this.config.trigger;\n    if (trigger === 'hover' || trigger === 'both') {\n      const element = event.currentTarget as HTMLElement;\n      if (this.activeElement === element) {\n        // Small delay to allow focus to move to modal\n        setTimeout(() => {\n          if (this.activeElement === element) {\n            this.onClose(element, event);\n            this.activeElement = null;\n          }\n        }, 200);\n      }\n    }\n  }\n\n  /**\n   * Handle click event\n   */\n  private handleClick(event: Event): void {\n    const element = event.currentTarget as HTMLElement;\n\n    // If element is a link in 'both' mode, don't prevent default\n    // but still show modal\n    if (element instanceof HTMLAnchorElement && this.config.behavior === 'both') {\n      // Let the link work, but also show modal\n      this.activeElement = element;\n      this.onOpen(element, event);\n      return;\n    }\n\n    // For modal-only or if not a link, prevent default and show modal\n    if (this.config.behavior === 'modal-only' || !(element instanceof HTMLAnchorElement)) {\n      event.preventDefault();\n    }\n\n    // Toggle modal\n    if (this.activeElement === element) {\n      this.onClose(element, event);\n      this.activeElement = null;\n    } else {\n      this.activeElement = element;\n      this.onOpen(element, event);\n    }\n  }\n\n  /**\n   * Handle keyboard events (Enter/Space to open)\n   */\n  private handleKeyDown(event: Event): void {\n    const keyEvent = event as KeyboardEvent;\n    const element = event.currentTarget as HTMLElement;\n\n    // Enter or Space to open/toggle modal\n    if (keyEvent.key === 'Enter' || keyEvent.key === ' ') {\n      // Prevent default scroll on Space\n      if (keyEvent.key === ' ') {\n        keyEvent.preventDefault();\n      }\n\n      // Don't interfere with link behavior if it's a link element\n      if (element instanceof HTMLAnchorElement && keyEvent.key === 'Enter') {\n        // Let Enter work naturally on links, but also show modal\n        this.activeElement = element;\n        this.onOpen(element, event);\n        return;\n      }\n\n      // Toggle modal for non-links or Space key\n      if (this.activeElement === element) {\n        this.onClose(element, event);\n        this.activeElement = null;\n      } else {\n        this.activeElement = element;\n        this.onOpen(element, event);\n      }\n    }\n  }\n\n  /**\n   * Get the currently active element\n   */\n  getActiveElement(): HTMLElement | null {\n    return this.activeElement;\n  }\n\n  /**\n   * Clear the active element\n   */\n  clearActive(): void {\n    this.activeElement = null;\n    this.debouncedMouseEnter.cancel();\n    if (this.mouseLeaveTimeout) {\n      clearTimeout(this.mouseLeaveTimeout);\n      this.mouseLeaveTimeout = null;\n    }\n  }\n\n  /**\n   * Close the modal for the active element\n   */\n  closeActive(): void {\n    if (this.activeElement) {\n      this.onClose(this.activeElement, new Event('close'));\n      this.activeElement = null;\n    }\n  }\n}\n", "/**\n * HTML Sanitizer\n * XSS prevention utilities for safe rendering of API content\n * CSP-compliant: no inline scripts, no eval, no dangerous protocols\n */\n\n/**\n * List of allowed HTML tags for verse content\n * Only formatting tags that are safe and commonly used in scripture text\n */\nconst ALLOWED_TAGS = new Set([\n  'p', 'br', 'span', 'div', 'strong', 'em', 'b', 'i', 'sup', 'sub'\n]);\n\n/**\n * List of allowed attributes for HTML elements\n * Only safe attributes that don't execute code\n */\nconst ALLOWED_ATTRS = new Set([\n  'class', 'id', 'title', 'lang', 'dir'\n]);\n\n/**\n * Sanitize HTML content using DOMParser\n * Removes potentially dangerous elements and attributes\n * CSP-compliant: no inline event handlers, no dangerous protocols\n */\nexport function sanitizeHtml(html: string): string {\n  // Use DOMParser to parse HTML safely (no code execution)\n  const parser = new DOMParser();\n  const doc = parser.parseFromString(html, 'text/html');\n\n  // Remove all script tags\n  const scripts = doc.querySelectorAll('script');\n  scripts.forEach(script => script.remove());\n\n  // Remove potentially dangerous elements\n  const dangerousElements = doc.querySelectorAll(\n    'iframe, object, embed, link, style, base, meta, form, input, textarea, button, select'\n  );\n  dangerousElements.forEach(el => el.remove());\n\n  // Remove event handler attributes from all elements\n  const allElements = doc.querySelectorAll('*');\n  allElements.forEach(el => {\n    // Remove disallowed tags\n    if (!ALLOWED_TAGS.has(el.tagName.toLowerCase())) {\n      // Replace with text content only\n      const textNode = document.createTextNode(el.textContent || '');\n      el.parentNode?.replaceChild(textNode, el);\n      return;\n    }\n\n    // Remove all on* attributes (onclick, onerror, onload, etc.)\n    Array.from(el.attributes).forEach(attr => {\n      if (attr.name.startsWith('on')) {\n        el.removeAttribute(attr.name);\n      }\n\n      // Remove attributes not in allowed list\n      if (!ALLOWED_ATTRS.has(attr.name.toLowerCase())) {\n        el.removeAttribute(attr.name);\n      }\n    });\n\n    // Remove dangerous attributes\n    el.removeAttribute('formaction');\n    el.removeAttribute('action');\n    el.removeAttribute('data');\n    el.removeAttribute('srcdoc');\n    el.removeAttribute('href');\n    el.removeAttribute('src');\n    el.removeAttribute('xlink:href');\n  });\n\n  // Validate and sanitize URLs in href and src attributes\n  // (Should be mostly removed by above, but double-check)\n  const elementsWithUrls = doc.querySelectorAll('[href], [src]');\n  elementsWithUrls.forEach(el => {\n    const href = el.getAttribute('href');\n    const src = el.getAttribute('src');\n\n    if (href && !isValidUrl(href)) {\n      el.removeAttribute('href');\n    }\n\n    if (src && !isValidUrl(src)) {\n      el.removeAttribute('src');\n    }\n  });\n\n  return doc.body.innerHTML;\n}\n\n/**\n * Validate URL to prevent javascript: and data: URIs\n */\nfunction isValidUrl(url: string): boolean {\n  // Remove whitespace and convert to lowercase for checking\n  const normalized = url.trim().toLowerCase();\n\n  // Block dangerous protocols\n  const dangerousProtocols = ['javascript:', 'data:', 'vbscript:', 'file:'];\n  if (dangerousProtocols.some(protocol => normalized.startsWith(protocol))) {\n    return false;\n  }\n\n  // Allow http, https, mailto, and relative URLs\n  if (\n    normalized.startsWith('http://') ||\n    normalized.startsWith('https://') ||\n    normalized.startsWith('mailto:') ||\n    normalized.startsWith('//') ||\n    normalized.startsWith('/') ||\n    normalized.startsWith('#')\n  ) {\n    return true;\n  }\n\n  // If it doesn't have a protocol, it's a relative URL - allow it\n  if (!normalized.includes(':')) {\n    return true;\n  }\n\n  // Block everything else\n  return false;\n}\n\n/**\n * Escape HTML special characters\n * Use this for rendering user-provided text content\n */\nexport function escapeHtml(text: string): string {\n  const div = document.createElement('div');\n  div.textContent = text;\n  return div.innerHTML;\n}\n\n/**\n * Create a safe text node\n * Safest way to add user content to the DOM\n */\nexport function createTextNode(text: string): Text {\n  return document.createTextNode(text);\n}\n\n/**\n * Sanitize URL for use in href/src attributes\n */\nexport function sanitizeUrl(url: string): string {\n  if (!isValidUrl(url)) {\n    return '#';\n  }\n  return url;\n}\n\n/**\n * Create a safe link element\n */\nexport function createSafeLink(\n  text: string,\n  href: string,\n  options?: {\n    className?: string;\n    target?: string;\n    rel?: string;\n  }\n): HTMLAnchorElement {\n  const link = document.createElement('a');\n  link.textContent = text; // Use textContent for safety\n  link.href = sanitizeUrl(href);\n\n  if (options?.className) {\n    link.className = options.className;\n  }\n\n  if (options?.target) {\n    link.target = options.target;\n    // Always add rel=\"noopener noreferrer\" for external links\n    if (options.target === '_blank') {\n      link.rel = 'noopener noreferrer';\n    }\n  }\n\n  if (options?.rel) {\n    link.rel = options.rel;\n  }\n\n  return link;\n}\n", "/**\n * Modal Renderer\n * Renders verse content in the modal with proper formatting and safety\n */\n\nimport type { VerseContent } from '../api/youversion-client';\nimport type { VersetaggerConfig } from '../core/config';\nimport { createSafeLink, createTextNode } from '../utils/sanitizer';\n\n/**\n * Render verse content into modal container\n */\nexport function renderVerseContent(\n  container: HTMLElement,\n  content: VerseContent,\n  config: Required<VersetaggerConfig>\n): void {\n  // Clear container\n  container.innerHTML = '';\n\n  // Create header with reference and version\n  const header = document.createElement('div');\n  header.className = 'versetagger-modal-header';\n\n  const referenceTitle = document.createElement('h3');\n  referenceTitle.className = 'versetagger-modal-reference';\n  referenceTitle.appendChild(createTextNode(content.reference));\n  header.appendChild(referenceTitle);\n\n  const versionBadge = document.createElement('span');\n  versionBadge.className = 'versetagger-modal-version';\n  versionBadge.appendChild(createTextNode(content.version));\n  header.appendChild(versionBadge);\n\n  container.appendChild(header);\n\n  // Create content container\n  const contentContainer = document.createElement('div');\n  contentContainer.className = 'versetagger-modal-content';\n\n  // Render verse content\n  const contentText = document.createElement('p');\n  contentText.className = 'versetagger-content-text';\n\n  // Apply error styling if this is an error message\n  if (content.isError) {\n    contentText.classList.add('versetagger-content-error');\n  }\n\n  // Set plain text content directly (API returns plain text, not HTML)\n  contentText.textContent = content.content;\n\n  contentContainer.appendChild(contentText);\n  container.appendChild(contentContainer);\n\n  // Create footer with link to YouVersion\n  const footer = document.createElement('div');\n  footer.className = 'versetagger-modal-footer';\n\n  const youversionLink = createYouVersionLink(content, config);\n  footer.appendChild(youversionLink);\n\n  container.appendChild(footer);\n}\n\n/**\n * Create link to YouVersion for full context\n */\nfunction createYouVersionLink(\n  content: VerseContent,\n  config: Required<VersetaggerConfig>\n): HTMLAnchorElement {\n  // Build URL using link format from config\n  let url = config.linkFormat;\n\n  // Get version ID for YouVersion URL\n  const versionId = getVersionId(content.version);\n\n  // Replace placeholders\n  url = url\n    .replace('{version}', versionId)\n    .replace('{book}', content.book)\n    .replace('{chapter}', content.chapter.toString())\n    .replace('{verses}', content.verses);\n\n  // Create safe link\n  const link = createSafeLink(\n    'Read on Bible.com',\n    url,\n    {\n      className: 'versetagger-youversion-link',\n      target: config.openLinksInNewTab ? '_blank' : undefined,\n      rel: 'noopener noreferrer'\n    }\n  );\n\n  // Add icon\n  const icon = document.createElement('span');\n  icon.className = 'versetagger-external-icon';\n  icon.innerHTML = '&nbsp;\u2197';\n  link.appendChild(icon);\n\n  return link;\n}\n\n/**\n * Get YouVersion version ID from version abbreviation\n */\nfunction getVersionId(version: string): string {\n  // Map common versions to YouVersion IDs\n  const versionMap: Record<string, string> = {\n    'NIV': '111',\n    'ESV': '59',\n    'NLT': '116',\n    'KJV': '1',\n    'NKJV': '114',\n    'NASB': '100',\n    'CSB': '1713',\n    'AMP': '1588',\n    'MSG': '97',\n    'NRSV': '2016'\n  };\n\n  return versionMap[version.toUpperCase()] || version;\n}\n\n\n", "/**\n * Preset theme definitions for VerseTagger\n * Hardcoded light and dark themes with professional, accessible colors\n */\n\nexport interface ThemeColors {\n  // Modal container\n  modalBackground: string;\n  modalBorder: string;\n  modalShadow: string;\n\n  // Text colors\n  textPrimary: string;\n  textSecondary: string;\n  textMuted: string;\n\n  // Interactive elements\n  linkColor: string;\n  linkHoverColor: string;\n\n  // Verse numbers\n  verseNumberColor: string;\n\n  // Loading/error states\n  loadingColor: string;\n  errorBackground: string;\n  errorText: string;\n\n  // Close button\n  closeButtonColor: string;\n  closeButtonHoverColor: string;\n  closeButtonBackground: string;\n  closeButtonHoverBackground: string;\n}\n\nexport interface ThemeSpacing {\n  modalPadding: string;\n  modalBorderRadius: string;\n  modalMaxWidth: string;\n  versePadding: string;\n  verseGap: string;\n}\n\nexport interface ThemeFonts {\n  fontFamily: string;\n  fontSize: string;\n  lineHeight: string;\n  verseNumberSize: string;\n}\n\nexport interface Theme {\n  name: string;\n  colors: ThemeColors;\n  spacing: ThemeSpacing;\n  fonts: ThemeFonts;\n}\n\n/**\n * Default Light Theme\n * High contrast, professional appearance suitable for most websites\n */\nexport const lightTheme: Theme = {\n  name: 'light',\n  colors: {\n    // Modal container\n    modalBackground: '#ffffff',\n    modalBorder: '#e5e7eb',\n    modalShadow: 'rgba(0, 0, 0, 0.1)',\n\n    // Text colors\n    textPrimary: '#111827',\n    textSecondary: '#374151',\n    textMuted: '#6b7280',\n\n    // Interactive elements\n    linkColor: '#2563eb',\n    linkHoverColor: '#1d4ed8',\n\n    // Verse numbers\n    verseNumberColor: '#9ca3af',\n\n    // Loading/error states\n    loadingColor: '#6b7280',\n    errorBackground: '#fef2f2',\n    errorText: '#dc2626',\n\n    // Close button\n    closeButtonColor: '#6b7280',\n    closeButtonHoverColor: '#111827',\n    closeButtonBackground: 'transparent',\n    closeButtonHoverBackground: '#f3f4f6',\n  },\n  spacing: {\n    modalPadding: '16px',\n    modalBorderRadius: '8px',\n    modalMaxWidth: '400px',\n    versePadding: '8px 0',\n    verseGap: '4px',\n  },\n  fonts: {\n    fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif',\n    fontSize: '14px',\n    lineHeight: '1.6',\n    verseNumberSize: '12px',\n  },\n};\n\n/**\n * Default Dark Theme\n * Comfortable dark mode colors with reduced eye strain\n */\nexport const darkTheme: Theme = {\n  name: 'dark',\n  colors: {\n    // Modal container\n    modalBackground: '#1f2937',\n    modalBorder: '#374151',\n    modalShadow: 'rgba(0, 0, 0, 0.5)',\n\n    // Text colors\n    textPrimary: '#f9fafb',\n    textSecondary: '#e5e7eb',\n    textMuted: '#9ca3af',\n\n    // Interactive elements\n    linkColor: '#60a5fa',\n    linkHoverColor: '#93c5fd',\n\n    // Verse numbers\n    verseNumberColor: '#6b7280',\n\n    // Loading/error states\n    loadingColor: '#9ca3af',\n    errorBackground: '#7f1d1d',\n    errorText: '#fca5a5',\n\n    // Close button\n    closeButtonColor: '#9ca3af',\n    closeButtonHoverColor: '#f9fafb',\n    closeButtonBackground: 'transparent',\n    closeButtonHoverBackground: '#374151',\n  },\n  spacing: {\n    modalPadding: '16px',\n    modalBorderRadius: '8px',\n    modalMaxWidth: '400px',\n    versePadding: '8px 0',\n    verseGap: '4px',\n  },\n  fonts: {\n    fontFamily: '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif',\n    fontSize: '14px',\n    lineHeight: '1.6',\n    verseNumberSize: '12px',\n  },\n};\n\n/**\n * Get preset theme by name\n */\nexport function getPresetTheme(name: 'light' | 'dark'): Theme {\n  return name === 'dark' ? darkTheme : lightTheme;\n}\n\n/**\n * All available preset themes\n */\nexport const presetThemes = {\n  light: lightTheme,\n  dark: darkTheme,\n};\n", "/**\n * CSS Injector\n * Dynamically injects and manages stylesheets in the document\n */\n\nconst STYLE_ID_PREFIX = 'versetagger-styles';\nconst THEME_VARS_ID = `${STYLE_ID_PREFIX}-theme-vars`;\nconst BASE_STYLES_ID = `${STYLE_ID_PREFIX}-base`;\n\n/**\n * Inject CSS custom properties (theme variables) into the document\n * Creates or updates a <style> tag with CSS variables\n */\nexport function injectThemeVariables(variables: Record<string, string>): void {\n  let styleTag = document.getElementById(THEME_VARS_ID) as HTMLStyleElement;\n\n  if (!styleTag) {\n    styleTag = document.createElement('style');\n    styleTag.id = THEME_VARS_ID;\n    document.head.appendChild(styleTag);\n  }\n\n  // Build CSS custom properties\n  const cssVars = Object.entries(variables)\n    .map(([key, value]) => `  --vt-${key}: ${value};`)\n    .join('\\n');\n\n  styleTag.textContent = `:root {\\n${cssVars}\\n}`;\n}\n\n/**\n * Inject base CSS styles for the modal\n * Creates a <style> tag with the base stylesheet\n */\nexport function injectBaseStyles(css: string): void {\n  let styleTag = document.getElementById(BASE_STYLES_ID) as HTMLStyleElement;\n\n  if (!styleTag) {\n    styleTag = document.createElement('style');\n    styleTag.id = BASE_STYLES_ID;\n    document.head.appendChild(styleTag);\n  }\n\n  styleTag.textContent = css;\n}\n\n/**\n * Remove all VerseTagger styles from the document\n * Used during cleanup/destroy\n */\nexport function removeAllStyles(): void {\n  const themeVarsTag = document.getElementById(THEME_VARS_ID);\n  const baseStylesTag = document.getElementById(BASE_STYLES_ID);\n\n  if (themeVarsTag) {\n    themeVarsTag.remove();\n  }\n\n  if (baseStylesTag) {\n    baseStylesTag.remove();\n  }\n}\n\n/**\n * Check if base styles are already injected\n */\nexport function hasBaseStyles(): boolean {\n  return document.getElementById(BASE_STYLES_ID) !== null;\n}\n\n/**\n * Check if theme variables are already injected\n */\nexport function hasThemeVariables(): boolean {\n  return document.getElementById(THEME_VARS_ID) !== null;\n}\n", "/**\n * Theme Manager\n * Handles theme validation, application, auto-detection, and switching\n */\n\nimport type { Theme, ThemeColors, ThemeSpacing, ThemeFonts } from './preset-themes';\nimport { getPresetTheme } from './preset-themes';\nimport { injectThemeVariables, injectBaseStyles, hasBaseStyles } from './css-injector';\nimport { MODAL_BASE_STYLES } from '../modal/modal-styles';\n\nexport type ThemeMode = 'light' | 'dark' | 'auto';\n\n/**\n * ThemeManager handles all theme-related functionality\n */\nexport class ThemeManager {\n  private currentTheme: Theme;\n  private mode: ThemeMode;\n  private mediaQuery: MediaQueryList | null = null;\n  private mediaQueryListener: ((e: MediaQueryListEvent) => void) | null = null;\n\n  constructor(mode: ThemeMode = 'auto', customTheme?: Partial<Theme>) {\n    this.mode = mode;\n\n    // Resolve initial theme\n    if (customTheme) {\n      this.currentTheme = this.validateAndMergeTheme(customTheme);\n    } else {\n      this.currentTheme = this.resolveTheme(mode);\n    }\n\n    // Setup auto-detection if mode is 'auto'\n    if (mode === 'auto') {\n      this.setupAutoDetection();\n    }\n  }\n\n  /**\n   * Initialize the theme system\n   * Injects base styles and applies the current theme\n   */\n  public init(): void {\n    // Inject base styles if not already present\n    if (!hasBaseStyles()) {\n      injectBaseStyles(MODAL_BASE_STYLES);\n    }\n\n    // Apply the current theme\n    this.applyTheme(this.currentTheme);\n  }\n\n  /**\n   * Switch to a different theme\n   * Can accept 'light', 'dark', or a custom theme object\n   */\n  public setTheme(theme: 'light' | 'dark' | Partial<Theme>): void {\n    if (typeof theme === 'string') {\n      this.currentTheme = getPresetTheme(theme);\n      this.mode = theme;\n    } else {\n      this.currentTheme = this.validateAndMergeTheme(theme);\n      this.mode = 'auto'; // Custom themes don't have a specific mode\n    }\n\n    this.applyTheme(this.currentTheme);\n  }\n\n  /**\n   * Get the current theme\n   */\n  public getCurrentTheme(): Theme {\n    return this.currentTheme;\n  }\n\n  /**\n   * Get the current theme mode\n   */\n  public getMode(): ThemeMode {\n    return this.mode;\n  }\n\n  /**\n   * Cleanup theme manager\n   * Removes auto-detection listener\n   */\n  public destroy(): void {\n    if (this.mediaQuery && this.mediaQueryListener) {\n      this.mediaQuery.removeListener(this.mediaQueryListener);\n      this.mediaQueryListener = null;\n      this.mediaQuery = null;\n    }\n  }\n\n  /**\n   * Resolve theme based on mode\n   */\n  private resolveTheme(mode: ThemeMode): Theme {\n    if (mode === 'auto') {\n      return this.detectColorScheme() === 'dark' ? getPresetTheme('dark') : getPresetTheme('light');\n    }\n    return getPresetTheme(mode);\n  }\n\n  /**\n   * Detect system color scheme preference\n   */\n  private detectColorScheme(): 'light' | 'dark' {\n    if (typeof window === 'undefined' || !window.matchMedia) {\n      return 'light';\n    }\n\n    const darkModeQuery = window.matchMedia('(prefers-color-scheme: dark)');\n    return darkModeQuery.matches ? 'dark' : 'light';\n  }\n\n  /**\n   * Setup auto-detection for color scheme changes\n   */\n  private setupAutoDetection(): void {\n    if (typeof window === 'undefined' || !window.matchMedia) {\n      return;\n    }\n\n    this.mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n    this.mediaQueryListener = (e: MediaQueryListEvent) => {\n      const newTheme = e.matches ? getPresetTheme('dark') : getPresetTheme('light');\n      this.currentTheme = newTheme;\n      this.applyTheme(newTheme);\n    };\n\n    // Modern browsers\n    if (this.mediaQuery.addEventListener) {\n      this.mediaQuery.addEventListener('change', this.mediaQueryListener);\n    } else {\n      // Fallback for older browsers\n      this.mediaQuery.addListener(this.mediaQueryListener);\n    }\n  }\n\n  /**\n   * Apply theme by injecting CSS custom properties\n   */\n  private applyTheme(theme: Theme): void {\n    const cssVariables = this.themeToCSSVariables(theme);\n    injectThemeVariables(cssVariables);\n  }\n\n  /**\n   * Convert theme object to CSS custom properties\n   */\n  private themeToCSSVariables(theme: Theme): Record<string, string> {\n    const variables: Record<string, string> = {};\n\n    // Colors\n    Object.entries(theme.colors).forEach(([key, value]) => {\n      variables[key] = value;\n    });\n\n    // Spacing\n    Object.entries(theme.spacing).forEach(([key, value]) => {\n      variables[key] = value;\n    });\n\n    // Fonts\n    Object.entries(theme.fonts).forEach(([key, value]) => {\n      variables[key] = value;\n    });\n\n    return variables;\n  }\n\n  /**\n   * Validate and merge custom theme with defaults\n   * Ensures all required properties exist\n   */\n  private validateAndMergeTheme(customTheme: Partial<Theme>): Theme {\n    const baseTheme = getPresetTheme('light');\n\n    // Deep merge colors\n    const colors: ThemeColors = {\n      ...baseTheme.colors,\n      ...(customTheme.colors || {}),\n    };\n\n    // Deep merge spacing\n    const spacing: ThemeSpacing = {\n      ...baseTheme.spacing,\n      ...(customTheme.spacing || {}),\n    };\n\n    // Deep merge fonts\n    const fonts: ThemeFonts = {\n      ...baseTheme.fonts,\n      ...(customTheme.fonts || {}),\n    };\n\n    return {\n      name: customTheme.name || 'custom',\n      colors,\n      spacing,\n      fonts,\n    };\n  }\n\n  /**\n   * Validate theme object structure\n   * Returns true if theme has all required properties\n   */\n  public static isValidTheme(theme: unknown): theme is Theme {\n    if (!theme || typeof theme !== 'object') {\n      return false;\n    }\n\n    const t = theme as Partial<Theme>;\n\n    // Check for required top-level properties\n    if (!t.colors || !t.spacing || !t.fonts) {\n      return false;\n    }\n\n    // Validate colors\n    const requiredColorProps: (keyof ThemeColors)[] = [\n      'modalBackground',\n      'modalBorder',\n      'modalShadow',\n      'textPrimary',\n      'textSecondary',\n      'textMuted',\n      'linkColor',\n      'linkHoverColor',\n      'verseNumberColor',\n      'loadingColor',\n      'errorBackground',\n      'errorText',\n      'closeButtonColor',\n      'closeButtonHoverColor',\n      'closeButtonBackground',\n      'closeButtonHoverBackground',\n    ];\n\n    for (const prop of requiredColorProps) {\n      if (typeof t.colors[prop] !== 'string') {\n        return false;\n      }\n    }\n\n    // Validate spacing\n    const requiredSpacingProps: (keyof ThemeSpacing)[] = [\n      'modalPadding',\n      'modalBorderRadius',\n      'modalMaxWidth',\n      'versePadding',\n      'verseGap',\n    ];\n\n    for (const prop of requiredSpacingProps) {\n      if (typeof t.spacing[prop] !== 'string') {\n        return false;\n      }\n    }\n\n    // Validate fonts\n    const requiredFontProps: (keyof ThemeFonts)[] = [\n      'fontFamily',\n      'fontSize',\n      'lineHeight',\n      'verseNumberSize',\n    ];\n\n    for (const prop of requiredFontProps) {\n      if (typeof t.fonts[prop] !== 'string') {\n        return false;\n      }\n    }\n\n    return true;\n  }\n}\n", "/**\n * VerseTagger Main Entry Point\n * Orchestrates all modules to provide scripture reference tagging functionality\n */\n\nimport type { VersetaggerConfig } from './config';\nimport { createConfig, mergeConfig } from './config';\nimport type { ScriptureReference } from '../parser/reference-parser';\nimport { DOMScanner, type ScannedReference } from './scanner';\nimport { YouVersionClient, type VerseContent } from '../api/youversion-client';\nimport { ModalManager } from '../modal/modal-manager';\nimport { EventHandler } from '../modal/event-handler';\nimport { renderVerseContent } from '../modal/modal-renderer';\nimport { ThemeManager } from '../theming/theme-manager';\nimport type { Theme } from '../theming/preset-themes';\nimport { findVersion } from '../parser/bible-versions';\nimport { findBook } from '../parser/book-mappings';\n\n/**\n * Main VerseTagger class\n * Public API for the library\n */\nexport class VerseTagger {\n  private config: Required<VersetaggerConfig>;\n  private scanner: DOMScanner;\n  private apiClient: YouVersionClient;\n  private modalManager: ModalManager;\n  private eventHandler: EventHandler;\n  private themeManager: ThemeManager;\n  private scannedReferences: ScannedReference[] = [];\n  private initialized = false;\n  private cache: Map<string, VerseContent> = new Map();\n\n  /**\n   * Create a new VerseTagger instance\n   * @param config - Configuration options\n   */\n  constructor(config: VersetaggerConfig) {\n    // Validate and merge config with defaults\n    this.config = createConfig(config);\n\n    // Initialize modules\n    this.scanner = new DOMScanner(this.config);\n    this.apiClient = new YouVersionClient({\n      proxyUrl: this.config.proxyUrl,\n      defaultVersion: this.config.defaultVersion,\n      debug: this.config.debug\n    });\n\n    this.modalManager = new ModalManager(this.config);\n    this.eventHandler = new EventHandler(\n      this.config,\n      this.handleReferenceOpen.bind(this),\n      this.handleReferenceClose.bind(this)\n    );\n\n    // Initialize theme manager\n    const colorScheme = this.config.colorScheme;\n    const customTheme = typeof this.config.theme === 'object' ? this.config.theme : undefined;\n    this.themeManager = new ThemeManager(colorScheme, customTheme);\n\n    // Setup theme\n    this.themeManager.init();\n\n    // Initialize modal with renderer\n    this.modalManager.initialize((container, content) => {\n      renderVerseContent(container, content, this.config);\n    });\n\n    this.initialized = true;\n\n    if (this.config.debug) {\n      console.log('[VerseTagger] Initialized with config:', this.config);\n    }\n\n    // Auto-scan on DOM ready if configured\n    if (this.config.autoScan) {\n      if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', () => this.scan());\n      } else {\n        // DOM already loaded, scan immediately\n        this.scan();\n      }\n    }\n  }\n\n  /**\n   * Scan the page (or specific element) for scripture references\n   * @param element - Optional element to scan (defaults to document)\n   * @returns Array of scanned references\n   */\n  scan(element?: HTMLElement): ScannedReference[] {\n    if (!this.initialized) {\n      throw new Error('VerseTagger: Cannot scan before initialization is complete');\n    }\n\n    const references = this.scanner.scan(element || document);\n\n    // Attach event handlers to new references\n    references.forEach(ref => {\n      this.eventHandler.attach(ref.element);\n    });\n\n    // Track scanned references\n    this.scannedReferences.push(...references);\n\n    if (this.config.debug) {\n      console.log(`[VerseTagger] Scanned ${references.length} references`, references);\n    }\n\n    return references;\n  }\n\n  /**\n   * Re-scan the entire page\n   * Clears previous scans and starts fresh\n   * @returns Array of scanned references\n   */\n  rescan(): ScannedReference[] {\n    if (!this.initialized) {\n      throw new Error('VerseTagger: Cannot rescan before initialization is complete');\n    }\n\n    // Clear scanner cache\n    this.scanner.clearCache();\n\n    // Clear tracked references\n    this.scannedReferences = [];\n\n    // Scan again\n    return this.scan();\n  }\n\n  /**\n   * Update configuration\n   * Applies new settings without requiring full re-initialization\n   * @param newConfig - Partial configuration to update\n   */\n  updateConfig(newConfig: Partial<VersetaggerConfig>): void {\n    if (!this.initialized) {\n      throw new Error('VerseTagger: Cannot update config before initialization is complete');\n    }\n\n    // Merge with existing config\n    this.config = mergeConfig({\n      ...this.config,\n      ...newConfig\n    });\n\n    // Update modules\n    this.apiClient.updateConfig({\n      proxyUrl: this.config.proxyUrl,\n      defaultVersion: this.config.defaultVersion,\n      debug: this.config.debug\n    });\n\n    this.modalManager.updateConfig(this.config);\n\n    // If theme changed, update theme manager\n    if (newConfig.theme || newConfig.colorScheme) {\n      const colorScheme = newConfig.colorScheme || this.config.colorScheme;\n      const customTheme = typeof newConfig.theme === 'object' ? newConfig.theme : undefined;\n\n      if (typeof newConfig.theme === 'string' && (newConfig.theme === 'light' || newConfig.theme === 'dark')) {\n        this.themeManager.setTheme(newConfig.theme);\n      } else if (customTheme) {\n        this.themeManager.setTheme(customTheme);\n      }\n    }\n\n    if (this.config.debug) {\n      console.log('[VerseTagger] Config updated:', this.config);\n    }\n  }\n\n  /**\n   * Set theme\n   * @param theme - Theme name ('light' or 'dark') or custom theme object\n   */\n  setTheme(theme: 'light' | 'dark' | Partial<Theme>): void {\n    if (!this.initialized) {\n      throw new Error('VerseTagger: Cannot set theme before initialization is complete');\n    }\n\n    this.themeManager.setTheme(theme);\n\n    if (this.config.debug) {\n      console.log('[VerseTagger] Theme updated:', theme);\n    }\n  }\n\n  /**\n   * Destroy the VerseTagger instance\n   * Cleanup all listeners, remove modals, and free resources\n   */\n  destroy(): void {\n    if (!this.initialized) {\n      return;\n    }\n\n    // Detach event handlers from all scanned references\n    this.scannedReferences.forEach(ref => {\n      try {\n        this.eventHandler.detach(ref.element);\n      } catch (e) {\n        // Element may have been removed from DOM\n        if (this.config.debug) {\n          console.warn('[VerseTagger] Error detaching event handler:', e);\n        }\n      }\n    });\n\n    // Clear tracked references\n    this.scannedReferences = [];\n\n    // Clear cache\n    this.cache.clear();\n\n    // Destroy modules\n    this.modalManager.destroy();\n    this.themeManager.destroy();\n\n    this.initialized = false;\n\n    if (this.config.debug) {\n      console.log('[VerseTagger] Destroyed');\n    }\n  }\n\n  /**\n   * Get current configuration\n   * @returns Current configuration object\n   */\n  getConfig(): Required<VersetaggerConfig> {\n    return { ...this.config };\n  }\n\n  /**\n   * Get all scanned references\n   * @returns Array of scanned references\n   */\n  getScannedReferences(): ScannedReference[] {\n    return [...this.scannedReferences];\n  }\n\n  /**\n   * Get cache statistics\n   * @returns Cache statistics\n   */\n  getCacheStats(): { size: number; keys: string[] } {\n    return {\n      size: this.cache.size,\n      keys: Array.from(this.cache.keys())\n    };\n  }\n\n  /**\n   * Clear the verse cache\n   */\n  clearCache(): void {\n    this.cache.clear();\n    if (this.config.debug) {\n      console.log('[VerseTagger] Cache cleared');\n    }\n  }\n\n  /**\n   * Handle reference open event\n   * @private\n   */\n  private async handleReferenceOpen(element: HTMLElement, event: Event): Promise<void> {\n    // Extract reference data from element\n    const book = element.dataset.book;\n    const chapter = element.dataset.chapter;\n    const verses = element.dataset.verses;\n    const version = element.dataset.version;\n\n    if (!book || !chapter) {\n      console.error('[VerseTagger] Missing reference data on element:', element);\n      return;\n    }\n\n    // Determine which version to use\n    const requestedVersion = version || this.config.defaultVersion;\n\n    // Check if the version is licensed\n    const versionInfo = findVersion(requestedVersion);\n    if (versionInfo && !versionInfo.licensed) {\n      // Show modal but display licensing message instead of making API call\n      this.modalManager.showLoading(element);\n\n      // Get full book name for display\n      const bookInfo = findBook(book);\n      const displayBookName = bookInfo ? bookInfo.name : book;\n\n      // Create a licensing message content\n      const licensingContent: VerseContent = {\n        book: book,\n        chapter: parseInt(chapter),\n        verses: verses || '',\n        reference: `${displayBookName} ${chapter}${verses ? ':' + verses : ''}`,\n        version: requestedVersion,\n        content: \"This Bible version isn't available to view here due to licensing restrictions.\",\n        isError: true\n      };\n\n      // Show the licensing message\n      this.modalManager.showContent(licensingContent);\n      return;\n    }\n\n    // Build cache key\n    const cacheKey = this.buildCacheKey(book, parseInt(chapter), verses || '', requestedVersion);\n\n    // Show loading state\n    this.modalManager.showLoading(element);\n\n    try {\n      // Check cache first\n      let content: VerseContent;\n      if (this.cache.has(cacheKey)) {\n        content = this.cache.get(cacheKey)!;\n        if (this.config.debug) {\n          console.log('[VerseTagger] Cache hit:', cacheKey);\n        }\n      } else {\n        // Fetch from API\n        if (this.config.debug) {\n          console.log('[VerseTagger] Fetching verse:', { book, chapter, verses, version });\n        }\n\n        const reference: ScriptureReference = {\n          book,\n          chapter: parseInt(chapter),\n          verses: verses || '',\n          version: version || undefined,\n          text: element.textContent || '',\n          startIndex: 0,\n          endIndex: 0\n        };\n\n        content = await this.apiClient.fetchVerse(reference);\n\n        // Cache the result\n        this.cache.set(cacheKey, content);\n      }\n\n      // Show content\n      this.modalManager.showContent(content);\n    } catch (error) {\n      console.error('[VerseTagger] Error fetching verse:', error);\n\n      let errorMessage = 'Failed to load verse content.';\n      if (error instanceof Error) {\n        errorMessage = error.message;\n      }\n\n      // Create error content with the same structure as licensing errors\n      // Get full book name for display\n      const bookInfo = findBook(book);\n      const displayBookName = bookInfo ? bookInfo.name : book;\n\n      const errorContent: VerseContent = {\n        book: book,\n        chapter: parseInt(chapter),\n        verses: verses || '',\n        reference: `${displayBookName} ${chapter}${verses ? ':' + verses : ''}`,\n        version: requestedVersion,\n        content: errorMessage,\n        isError: true\n      };\n\n      this.modalManager.showContent(errorContent);\n    }\n  }\n\n  /**\n   * Handle reference close event\n   * @private\n   */\n  private handleReferenceClose(element: HTMLElement, event: Event): void {\n    // Check if modal (or bridge) is being hovered before closing\n    const modalElement = document.getElementById('versetagger-modal');\n    if (modalElement?.getAttribute('data-modal-hovered') === 'true') {\n      // Don't close - user is hovering over modal or bridge\n      return;\n    }\n    this.modalManager.hide();\n  }\n\n  /**\n   * Build cache key for verse content\n   * @private\n   */\n  private buildCacheKey(book: string, chapter: number, verses: string, version: string): string {\n    return `${book}_${chapter}_${verses}_${version}`.toLowerCase();\n  }\n\n  /**\n   * Get library version\n   * @returns Version string\n   */\n  static get version(): string {\n    return '0.1.0';\n  }\n}\n\n// Export for use in other modules\nexport default VerseTagger;\n", "/**\n * VerseTagger - Scripture Reference Library\n * Main entry point for all module systems\n */\n\n// Main class\nexport { VerseTagger, default as VersetaggerDefault } from './core/VerseTagger';\n\n// Configuration types\nexport type {\n  VersetaggerConfig,\n  BehaviorMode,\n  TriggerMode,\n  ColorScheme\n} from './core/config';\n\n// Theme types\nexport type { Theme, ThemeColors, ThemeSpacing, ThemeFonts } from './theming/preset-themes';\n\n// API types\nexport type { VerseContent, ApiError } from './api/youversion-client';\n\n// Scanner types\nexport type { ScannedReference } from './core/scanner';\n\n// Reference parser types\nexport type { ScriptureReference } from './parser/reference-parser';\n\n// For convenience, also export as default\nimport { VerseTagger } from './core/VerseTagger';\nexport default VerseTagger;\n"],
  "mappings": "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AA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAwV1B,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",
  "names": ["e", "_a", "_b"]
}
